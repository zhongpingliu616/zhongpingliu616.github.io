import{_ as e,K as a,r as l,d as s,w as o,T as t,O as r,a as n,x as u,y as c,b as i,f as d,J as m,G as p,D as f,m as v,o as _,j as g,k as h,u as x,B as C,g as y,h as w,F as b,E as T,C as j}from"./index-E36eYFUz.js";import{_ as O}from"./OrderCard.CAQn7VUx.js";import{_ as B}from"./ProductList.aAvT4MfD.js";import{_ as I}from"./CustomBar.60VBE6jN.js";import{t as L,a as R}from"./xn.B6pvNNd_.js";import"./CxTag.DU_-stGW.js";import"./CxComfirmBtn.D_Y-qTM9.js";const S=e({__name:"index",setup(e){a((e=>({"7cc188c4":k})));const{proxy:S}=m(),k=S.$safeAreaInfo.top+24+"rpx";l("orders");let D=l("");const F=function(e,a=1500){let l=null;const s=()=>{l&&clearTimeout(l),l=setTimeout(e,a)};return s.cancel=()=>{l&&(clearTimeout(l),l=null)},s}((()=>{H(!0)}),1600);l(3);const V=l([]),$=l(!1),A=l(!1),E=l(1),G=l(10),M=l(!1),P=l("loadmore"),q=l("flower");let z=l({});const H=async(e=!1)=>{if((!$.value||e)&&(!A.value||e)&&(!M.value||e)){e?(E.value=1,M.value=!1,A.value=!0,P.value="loading"):($.value=!0,P.value="loading");try{const a=await L({page_no:E.value,page_size:G.value,keyword:D.value}),l=200===a.code&&a.data.lists||[];l.length<G.value?(M.value=!0,P.value="nomore"):P.value="loadmore",e?(V.value=l,p()):V.value=[...V.value,...l],E.value++}catch(a){P.value="loadmore",console.error("数据加载失败:",a),f({title:"加载失败",icon:"none"})}finally{$.value=!1,A.value=!1}}},J=()=>{A.value||H(!0)},K=()=>{$.value||M.value||H()},U=e=>{j({url:`/pages-xn/collection-detail/index?id=${e.id}`})},X=(e,a)=>{(async e=>{if(!e.id)return void f({title:"订单ID不能为空",icon:"none"});const{code:a,msg:l,data:s={}}=await R({id:e.id});200==a?(f({title:"订单创建成功",icon:"success"}),z.value=s.lists||{},z.value.id=e.id,setTimeout((()=>{j({url:`/pages-xn/my/deposit?id=${e.id}`,success:a=>{a.eventChannel.emit("sendMarginDatas",{marginResultData:{...e,...z.value}})},fail:e=>{console.error("跳转失败",e)}})}),1500)):f({title:l||"订单创建失败",icon:"none"})})(e)};s((()=>{H(!0)})),o(D,(e=>{F()}));const N=()=>{F()};return t((()=>{F&&F.cancel&&F.cancel()})),r((()=>{})),(e,a)=>{const l=v,s=T,o=n("up-col"),t=n("up-search"),r=n("up-row"),m=u(c("XnOrdersOrderCard"),O),p=u(c("BaseProductList"),B),f=u(c("LayoutCustomBar"),I);return _(),i(l,{class:"page-wrap orders"},{default:d((()=>[g(l),g(l,{class:"page-content"},{default:d((()=>[g(l,{class:"order-search"},{default:d((()=>[g(r,{customStyle:"margin-bottom: 10px"},{default:d((()=>[g(o,{span:"2"},{default:d((()=>[g(l,{class:"order-text-wrap"},{default:d((()=>[g(s,{class:"order-text"},{default:d((()=>[h("订单")])),_:1})])),_:1})])),_:1}),g(o,{span:"9"},{default:d((()=>[g(l,{class:"search-bar"},{default:d((()=>[g(t,{modelValue:x(D),"onUpdate:modelValue":a[0]||(a[0]=e=>C(D)?D.value=e:D=e),placeholder:"输入搜索内容",bgColor:"#fff",placeholderColor:"#AC9394",searchIconColor:"#672227",borderColor:"#FFE185",height:"66rpx",onSearch:N,"show-action":!1,clearabled:""},null,8,["modelValue"])])),_:1})])),_:1}),g(o,{span:"1"})])),_:1})])),_:1}),g(l,{class:"order-list"},{default:d((()=>[g(l,{class:"order-container"},{default:d((()=>[g(p,{onOnScrollToLower:K,onOnRefresh:J,isRefreshing:x(A),loadStatus:x(P),iconType:x(q),enableRefresh:!0,enableLoadMore:!0,class:"scroll-view"},{scrollContain:d((()=>[(_(!0),y(b,null,w(x(V),((e,a)=>(_(),i(m,{item:e,onGrabOrderClick:X,onHandleItemClick:U},null,8,["item"])))),256))])),_:1},8,["isRefreshing","loadStatus","iconType"])])),_:1})])),_:1})])),_:1}),g(f,{type:"xn"})])),_:1})}}},[["__scopeId","data-v-41ee4721"]]);export{S as default};
