import{_ as a,r as e,c as l,d as t,ai as s,x as o,y as c,b as i,f as n,J as d,D as r,ar as u,m,z as p,ac as f,o as _,j as g,u as v,k as y,t as x,B as h,g as F,h as k,F as b,aq as C,p as w,E as D,C as I}from"./index-E36eYFUz.js";import{_ as z}from"./Navigation.fXnM5b3z.js";import{_ as j}from"./CxTag.DU_-stGW.js";import{_ as B}from"./CxComfirmBtn.D_Y-qTM9.js";import{i as E,s as R,v as N}from"./xn.B6pvNNd_.js";const O=a({__name:"deposit",setup(a){var O;const{proxy:T}=d(),q=e(null);try{q.value=T.getOpenerEventChannel()}catch(Z){console.log("No event channel")}let A=e("缴纳保证金"),G=e(!1),S=e(!1),$=e({image:"https://picsum.photos/200",name:"古韵民族丝绸非遗刺绣",id:"234515665132",period:"工期30天",difficulty:"锦初等级",reward_amount:"188.00"});const J=e({deposit:5e3,label:"",order_id:""}),L=[{id:"balance",name:`账户余额(¥ ${(null==(O=T.$globalUserInfo)?void 0:O.amount)??0})`,uIcon:"rmb-circle-fill",iconColor:"#FF6B00"},{id:"wechat",name:"微信支付",uIcon:"weixin-fill",iconColor:"#09BB07"},{id:"alipay",name:"支付宝支付",uIcon:"zhifubao-circle-fill",iconColor:"#1677FF"}],M=e("balance"),P=l((()=>{const a=L.find((a=>a.id===M.value));return a?a.name.split("(")[0]:"请选择"})),U=e(!1);let H=e(["保证金单独支付，包含违约保证金和退货保证金两个部分；","违约保证金以5000元为固定额度；","保证金以5000元起步，每季度根据上季度月平均商家好店整体营业额调整，只升不降；","保证金额度不满时，需在10个自然日内补齐；","可使用“押金减免额度”进行押金减免；"]),K=e([]),Q=e({});const V=async a=>{if(U.value=a,a){let a=J.value.margin_amount>J.value.discount_amount?J.value.discount_amount:J.value.margin_amount;const{code:e,msg:l,data:t={}}=await R({order_id:J.value.order_id,amount:a});200==e?Y():r({title:l||"选择减免额度失败",icon:"none"})}},W=async()=>{(async()=>{I({url:"/pages-xn/orders/confirm-order",success:a=>{a.eventChannel.emit("sendOrderData",{marginResultData:J.value})}})})()},X=async()=>{S.value=!1,G.value=!0;const a=Q.value.id||(K.value.length>0?K.value[0].id:null);try{const{code:e,msg:l}=await N({address_id:a,order_id:J.value.order_id});200==e?(r({title:"缴纳保证金成功",icon:"success"}),setTimeout((()=>{C()}),1500)):r(100028==e?{title:l||"余额不足，请先充值",icon:"none"}:{title:l||"缴纳失败",icon:"none"})}catch(Z){console.error(Z)}finally{G.value=!1}},Y=async()=>{const{code:a,msg:e,data:l={}}=await E({order_id:J.value.order_id});200==a?J.value=l.lists||{deposit:0}:r({title:e||"获取保证金信息失败",icon:"none"})};return t((async()=>{(async()=>{const{code:a,msg:e,data:l={}}=await u();200==a?(K.value=l.lists||[],K.value.length>0&&(Q.value=K.value[0])):r({title:e||"获取地址列表失败",icon:"none"})})()})),s((a=>{a.id&&a.id,q.value&&q.value.on("sendMarginDatas",(a=>{console.log("Received marginResultData:",a.marginResultData),J.value=a.marginResultData||{deposit:0},Y(),a.productInfo&&Object.assign($.value,a.productInfo)}))})),(a,e)=>{const l=o(c("LayoutNavigation"),z),t=w,s=m,d=o(c("CxTag"),j),r=D,u=o(c("u-icon"),p),C=o(c("CxComfirmBtn"),B),I=o(c("u-popup"),f);return _(),i(s,{class:"page-wrap pay-deposit"},{default:n((()=>[g(l,{title:v(A)},null,8,["title"]),g(s,{class:"page-content"},{default:n((()=>[g(s,{class:"info-card product-card"},{default:n((()=>[g(t,{class:"product-img",src:v(J).image,mode:"aspectFill"},null,8,["src"]),g(s,{class:"product-details"},{default:n((()=>[g(s,{class:"product-title"},{default:n((()=>[y(x(v(J).name),1)])),_:1}),g(s,{class:"product-id"},{default:n((()=>[y("ID："+x(v(J).id),1)])),_:1}),g(s,{class:"product-tags"},{default:n((()=>[g(d,{shape:"circle",text:v(J).period||"",textStyle:{color:"#4A90E2"},bgGradient:["#E8F3FF","#E8F3FF"]},null,8,["text"]),g(d,{shape:"circle",textStyle:{color:"#999"},text:v(J).difficulty||"",bgGradient:["#F5F5F5","#F5F5F5"]},null,8,["text"])])),_:1}),g(s,{class:"product-price"},{default:n((()=>[g(r,{class:"symbol"},{default:n((()=>[y("¥")])),_:1}),g(r,{class:"amount"},{default:n((()=>[y(x(v(J).reward_amount),1)])),_:1})])),_:1})])),_:1})])),_:1}),g(s,{class:"info-card deposit-card"},{default:n((()=>[g(s,{class:"card-title-row"},{default:n((()=>[g(s,{class:"red-bar"}),g(r,{class:"card-title"},{default:n((()=>[y("保证金")])),_:1})])),_:1}),g(s,{class:"deposit-amount"},{default:n((()=>[g(r,{class:"symbol"},{default:n((()=>[y("¥")])),_:1}),g(r,{class:"value"},{default:n((()=>[y(x(v(J).deposit??0),1)])),_:1})])),_:1})])),_:1}),g(s,{class:"info-card payment-method-card",onClick:e[0]||(e[0]=a=>h(S)?S.value=!0:S=!0)},{default:n((()=>[g(s,{class:"card-title-row"},{default:n((()=>[g(s,{class:"red-bar"}),g(r,{class:"card-title"},{default:n((()=>[y("付款方式")])),_:1})])),_:1}),g(s,{class:"right-arrow"},{default:n((()=>[g(r,{class:"selected-method-text"},{default:n((()=>[y(x(v(P)),1)])),_:1}),g(u,{name:"arrow-down",color:"#999",size:"28rpx"})])),_:1})])),_:1}),g(s,{class:"info-card deduction-card"},{default:n((()=>[g(s,{class:"card-title-row"},{default:n((()=>[g(s,{class:"red-bar"}),g(r,{class:"card-title"},{default:n((()=>[y("保证金减免")])),_:1})])),_:1}),g(s,{class:"deduction-options"},{default:n((()=>[g(s,{class:"option-item",onClick:e[1]||(e[1]=a=>V(!0))},{default:n((()=>[g(s,{class:"radio-icon"},{default:n((()=>[v(U)?(_(),i(u,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"40rpx"})):(_(),i(s,{key:1,class:"radio-circle"}))])),_:1}),g(s,{class:"option-content"},{default:n((()=>[g(s,{class:"option-title"},{default:n((()=>[y("使用“保证金减免额度” （可抵扣"+x(v(J).discount_amount||0)+"元）",1)])),_:1}),g(s,{class:"option-desc"},{default:n((()=>[y("分享邀请二维码邀请好友注册并认证可获取“保证金”，您当前额度为："+x(v(J).margin_amount||0)+"元",1)])),_:1})])),_:1})])),_:1}),g(s,{class:"option-item",onClick:e[2]||(e[2]=a=>V(!1))},{default:n((()=>[g(s,{class:"radio-icon"},{default:n((()=>[v(U)?(_(),i(s,{key:1,class:"radio-circle"})):(_(),i(u,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"40rpx"}))])),_:1}),g(s,{class:"option-content"},{default:n((()=>[g(s,{class:"option-title"},{default:n((()=>[y("不使用")])),_:1}),g(s,{class:"option-desc"},{default:n((()=>[y("不使用任何押金减免，直接支付押金")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),g(s,{class:"guarantee-desc"},{default:n((()=>[g(s,{class:"desc-title"},{default:n((()=>[y("保证金说明：")])),_:1}),(_(!0),F(b,null,k(v(H),((a,e)=>(_(),i(s,{class:"desc-item",key:e},{default:n((()=>[y(x(e+1)+"、"+x(a),1)])),_:2},1024)))),128))])),_:1}),g(s,{class:"bottom-placeholder"})])),_:1}),g(s,{class:"fixed-bottom-btn"},{default:n((()=>[g(C,{text:"立即缴纳",loading:v(G),onClick:W},null,8,["loading"])])),_:1}),g(I,{show:v(S),mode:"bottom",round:"24rpx",closeable:!0,onClose:e[4]||(e[4]=a=>h(S)?S.value=!1:S=!1),bgColor:"#7a1e28"},{default:n((()=>[g(s,{class:"payment-popup-content"},{default:n((()=>[g(s,{class:"popup-title"},{default:n((()=>[y("请选择付款方式")])),_:1}),g(s,{class:"payment-list"},{default:n((()=>[(_(),F(b,null,k(L,(a=>g(s,{class:"payment-item",key:a.id,onClick:e=>M.value=a.id},{default:n((()=>[g(s,{class:"left-info"},{default:n((()=>[g(u,{name:a.icon,color:a.iconColor,size:"50rpx",customPrefix:"custom-icon"},null,8,["name","color"]),a.image?(_(),i(t,{key:0,src:a.image,style:{width:"50rpx",height:"50rpx","margin-right":"20rpx"},mode:"aspectFit"},null,8,["src"])):(_(),i(u,{key:1,name:a.uIcon,color:a.iconColor,size:"50rpx",style:{"margin-right":"20rpx"}},null,8,["name","color"])),g(r,{class:"method-name"},{default:n((()=>[y(x(a.name),1)])),_:2},1024)])),_:2},1024),g(s,{class:"right-check"},{default:n((()=>[v(M)===a.id?(_(),i(u,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"40rpx"})):(_(),i(s,{key:1,class:"radio-circle-yellow"}))])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1}),g(s,{class:"popup-btns"},{default:n((()=>[g(s,{class:"popup-btn cancel",onClick:e[3]||(e[3]=a=>h(S)?S.value=!1:S=!1)},{default:n((()=>[y("取消")])),_:1}),g(s,{class:"popup-btn confirm",onClick:X},{default:n((()=>[y("确定")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})}}},[["__scopeId","data-v-6dfee507"]]);export{O as default};
