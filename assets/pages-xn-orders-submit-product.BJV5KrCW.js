import{_ as a,r as e,ai as l,x as t,y as s,b as i,f as o,aL as n,J as u,m as d,aM as c,Z as r,o as f,j as m,k as _,t as p,u as v,B as g,a5 as h,D as x,H as b,E as w}from"./index-E36eYFUz.js";import{_ as y}from"./Navigation.fXnM5b3z.js";import{_ as j}from"./CxComfirmBtn.D_Y-qTM9.js";import{e as C}from"./xn.B6pvNNd_.js";const V=a({__name:"submit-product",setup(a){const V=e([]),A=e(""),I=e(""),L=e({});let O=e({});l((async a=>{const{proxy:e}=u(),l=e.getOpenerEventChannel();(async()=>{const{msg:a,code:e,data:l}=await n();200===e&&l.lists&&(console.log("平台收货地址",l.lists),O.value=l.lists||{})})(),l.on("sendOrderDatas",(a=>{a&&a.orderInfo&&(L.value=a.orderInfo)}))}));const k=async a=>{let e=[].concat(a.file),l=V.value.length;e.map((a=>{V.value.push({...a,status:"uploading",message:"上传中"})}));for(let s=0;s<e.length;s++)try{const a=await h(e[s].url);if(200!==a.code)throw new Error(a.msg||"上传失败");{let e=V.value[l];V.value.splice(l,1,Object.assign(e,{status:"success",message:"",url:a.data.url})),l++}}catch(t){let a=V.value[l];V.value.splice(l,1,Object.assign(a,{status:"failed",message:"上传失败"})),l++,x({title:"图片上传失败",icon:"none"})}},B=a=>{V.value.splice(a.index,1)},D=async()=>{if(!A.value)return void x({title:"请输入物流单号",icon:"none"});if(!I.value)return void x({title:"请输入物流公司",icon:"none"});if(0===V.value.length)return void x({title:"请上传完成后的照片",icon:"none"});if(V.value.filter((a=>"failed"===a.status)).length>0)x({title:"存在上传失败的图片，请删除后重试",icon:"none"});else if(L.value.id&&L.value.order_id)try{const{msg:a,code:e}=await C({id:L.value.id,order_id:L.value.order_id,status:50,tracking_number:A.value,logistics_company:I.value,image:V.value.map((a=>a.url)).join(",")});200===e?(x({title:"提交成功",icon:"success"}),setTimeout((()=>{b({url:`/pages-xn/orders/index?id=${L.value.id}&order_id=${L.value.order_id}`})}),1500)):x({title:a||"提交失败",icon:"none"})}catch(a){x({title:"提交失败",icon:"none"})}else x({title:"请返回订单列表重新进入此页面",icon:"none"})};return(a,e)=>{const l=t(s("LayoutNavigation"),y),n=d,u=w,h=t(s("u-upload"),c),x=t(s("u-input"),r),b=t(s("CxComfirmBtn"),j);return f(),i(n,{class:"page-wrap submit-product"},{default:o((()=>[m(l,{title:"提交成品"}),m(n,{class:"page-content"},{default:o((()=>[m(n,{class:"card"},{default:o((()=>[m(n,{class:"card-title-row"},{default:o((()=>[m(n,{class:"indicator"}),m(u,{class:"title-text"},{default:o((()=>[_("平台收货地址")])),_:1})])),_:1}),m(n,{class:"info-row"},{default:o((()=>[m(u,{class:"label"},{default:o((()=>[_("联系人")])),_:1}),m(u,{class:"value"},{default:o((()=>[_(p(v(O).contact_name||""),1)])),_:1})])),_:1}),m(n,{class:"info-row"},{default:o((()=>[m(u,{class:"label"},{default:o((()=>[_("联系电话")])),_:1}),m(u,{class:"value"},{default:o((()=>[_(p(v(O).contact_phone||""),1)])),_:1})])),_:1}),m(n,{class:"info-row align-top"},{default:o((()=>[m(u,{class:"label"},{default:o((()=>[_("收货地址")])),_:1}),m(u,{class:"value"},{default:o((()=>[_(p(v(O).shipping_address||""),1)])),_:1})])),_:1})])),_:1}),m(n,{class:"card"},{default:o((()=>[m(n,{class:"card-title-row"},{default:o((()=>[m(n,{class:"indicator"}),m(u,{class:"title-text"},{default:o((()=>[_("请上传完成后的照片")])),_:1})])),_:1}),m(n,{class:"upload-area"},{default:o((()=>[m(h,{fileList:v(V),onAfterRead:k,onDelete:B,name:"1",multiple:"",maxCount:3,width:"160rpx",height:"160rpx",previewFullImage:!0},null,8,["fileList"])])),_:1})])),_:1}),m(n,{class:"card"},{default:o((()=>[m(n,{class:"card-title-row"},{default:o((()=>[m(n,{class:"indicator"}),m(u,{class:"title-text"},{default:o((()=>[_("物流信息")])),_:1})])),_:1}),m(n,{class:"form-item"},{default:o((()=>[m(u,{class:"label"},{default:o((()=>[_("物流单号")])),_:1}),m(x,{modelValue:v(A),"onUpdate:modelValue":e[0]||(e[0]=a=>g(A)?A.value=a:null),placeholder:"请输入",border:"none",inputAlign:"right"},null,8,["modelValue"])])),_:1}),m(n,{class:"divider"}),m(n,{class:"form-item"},{default:o((()=>[m(u,{class:"label"},{default:o((()=>[_("物流公司")])),_:1}),m(x,{modelValue:v(I),"onUpdate:modelValue":e[1]||(e[1]=a=>g(I)?I.value=a:null),placeholder:"请输入",border:"none",inputAlign:"right"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(n,{class:"footer-btn"},{default:o((()=>[m(b,{text:"提交",onClick:D})])),_:1})])),_:1})}}},[["__scopeId","data-v-95b9d10f"]]);export{V as default};
