import{_ as a,r as e,ag as t,c as l,a4 as n,C as s,D as r,g as i,j as o,f as u,u as c,H as d,F as m,Q as p,J as g,m as f,a9 as v,as as _,a0 as k,aW as x,o as h,k as b,t as y,av as S,aw as C,aX as w,af as V,p as j,A as U}from"./index-DiJpDbC3.js";import{_ as W}from"./Navigation.CPbYaFbJ.js";import{_ as z}from"./CxComfirmBtn.CPDBkoVY.js";import{_ as L}from"./CxModal.B_6smIRI.js";const D=a({__name:"profile-edit",setup(a){const{proxy:D}=p();let F=D.getOpenerEventChannel(),M=e(null),B=e(!1),I={data:{url:""},code:-999,msg:""},N=t({avatar:"",reg_ip:"",nickname:"",signature:""}),T=e(!1),A=e("");const E=()=>{S({count:1,success:async a=>{I=await C(a.tempFilePaths[0]);const{code:e=9999,data:t={},msg:l=""}=I;200===e?(g({title:"上传成功，等待审核",icon:"success"}),N.avatar=t.url):g({title:l||"上传失败，请重试",icon:"none"})}})},H=async()=>{try{const a=await w({avatar:N.avatar||"",nick_name:N.nickname||"",signature:N.signature||""}),{code:e=9999,data:t,msg:l}=a;200===e?(g({title:"已提交",icon:"success"}),N.nickname=A.value||N.nickname,N.signature=N.signature||"",setTimeout((()=>{V({delta:1})}),1500)):g({title:l||"更新失败，请重试",icon:"none"})}catch(a){g({title:"更新失败，请重试",icon:"none"})}},J=l((()=>!(!B.value||!M.value)&&(N.avatar!==M.value.avatar||N.nickname!==M.value.nickname||N.signature!==M.value.signature))),O=()=>{A.value.trim()?N.nickname=A.value:g({title:"昵称不能为空",icon:"none"})},P=()=>{console.log("查看二维码")};return n((()=>{M.value={avatar:N.avatar,nickname:N.nickname,signature:N.signature},B.value=!0,F.on("sendUserData",(a=>{N.reg_ip=a.reg_ip,N.avatar=a.avatar,N.nickname=a.nick_name,N.signature=a.signature,M.value={avatar:N.avatar,nickname:N.nickname,signature:N.signature},B.value=!0}))})),(a,e)=>{const t=s(r("LayoutNavigation"),W),l=j,n=f,p=s(r("u-cell"),v),g=s(r("u-cell-group"),_),S=U,C=s(r("u-input"),k),w=s(r("u-textarea"),x),V=s(r("CxComfirmBtn"),z),D=s(r("CxModal"),L);return h(),i(m,null,[o(n,{class:"page-wrap profile-edit"},{default:u((()=>[o(t,{title:"编辑资料"}),o(n,{class:"page-content"},{default:u((()=>[o(n,{class:"form-card"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"头像",isLink:!0,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(n,{class:"avatar-wrap"},{default:u((()=>[o(l,{class:"avatar",src:c(N).avatar,mode:"aspectFill",onClick:E},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"ID",border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(S,{class:"id-text"},{default:u((()=>[b(y(c(N).reg_ip),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"昵称",isLink:!0,border:!0,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(C,{modelValue:c(N).nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>c(N).nickname=a),placeholder:"请输入昵称","input-align":"right",border:"none",class:"nickname-text"},null,8,["modelValue"])])),_:1}),o(p,{title:"我的二维码",isLink:!0,onClick:P,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"})])),_:1})])),_:1}),o(n,{class:"form-card mt-20 signature-card"},{default:u((()=>[o(n,{class:"signature-title"},{default:u((()=>[b("个性签名")])),_:1}),o(w,{modelValue:c(N).signature,"onUpdate:modelValue":e[1]||(e[1]=a=>c(N).signature=a),placeholder:"这里是个性签名...",border:"none",maxlength:100,height:"200",customStyle:"background: transparent; padding: 0;"},null,8,["modelValue"])])),_:1}),o(n,{class:"mt-20 save-profile"},{default:u((()=>[o(V,{text:"保存",disabled:!c(J),onClick:H},null,8,["disabled"])])),_:1})])),_:1})])),_:1}),o(D,{show:c(T),"onUpdate:show":e[3]||(e[3]=a=>d(T)?T.value=a:T=a),title:"修改昵称",onConfirm:O},{default:u((()=>[o(n,{class:"input-wrap"},{default:u((()=>[o(C,{modelValue:c(A),"onUpdate:modelValue":e[2]||(e[2]=a=>d(A)?A.value=a:A=a),placeholder:"请输入昵称",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-92cfc45b"]]);export{D as default};
