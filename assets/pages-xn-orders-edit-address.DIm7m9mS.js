import{ag as e,d as a,a as s,o as t,b as l,u as o,_ as d,r as n,a4 as i,Q as r,C as c,D as u,f as p,m as f,E as _,ah as m,j as h,k as v,y as g,t as w,H as b,J as x,ai as C,aj as y,ak as A,al as V,af as k,A as j,am as F,an as U}from"./index-DiJpDbC3.js";import{_ as P}from"./Navigation.CPbYaFbJ.js";import{_ as $}from"./CxComfirmBtn.CPDBkoVY.js";import{p as E,m as S,c as z,t as B}from"./town._mydTJVR.js";const D={__name:"CxAreaPicker",props:{show:{type:Boolean,default:!1}},emits:["update:show","confirm"],setup(d,{emit:n}){const i=n,r=e([[],[],[],[]]),c=e({provinces:E,cities:S,counties:z,towns:B}),u=e([0,0,0,0]),p=e=>{const{indexs:a}=e;if(console.log("Picker Change:",a),a[0]!==u[0]){const e=r[0][a[0]];if(e){const a=c.cities.filter((a=>a.pid===e.id));r[1]=a;const s=a[0]||{},t=c.counties.filter((e=>e.pid===s.id));r[2]=t;const l=t[0]||{},o=c.towns.filter((e=>e.pid===l.id));r[3]=o}else r[1]=[],r[2]=[],r[3]=[];u[0]=a[0],u[1]=0,u[2]=0,u[3]=0}else if(a[1]!==u[1]){const e=r[1][a[1]];if(e){const a=c.counties.filter((a=>a.pid===e.id));r[2]=a;const s=a[0]||{},t=c.towns.filter((e=>e.pid===s.id));r[3]=t}else r[2]=[],r[3]=[];u[1]=a[1],u[2]=0,u[3]=0}else if(a[2]!==u[2]){const e=r[2][a[2]];if(e){const a=c.towns.filter((a=>a.pid===e.id));r[3]=a}else r[3]=[];u[2]=a[2],u[3]=0}else a[3]!==u[3]&&(u[3]=a[3])},f=e=>{i("update:show",!1),i("confirm",e)},_=()=>{i("update:show",!1)};return a((()=>{(()=>{if(c.provinces.length>0){const e=c.provinces,a=e[0],s=c.cities.filter((e=>e.pid===a.id)),t=s[0]||{},l=c.counties.filter((e=>e.pid===t.id)),o=l[0]||{},d=c.towns.filter((e=>e.pid===o.id));r.splice(0,r.length),r.push(e),r.push(s),r.push(l),r.push(d)}})()})),(e,a)=>{const n=s("up-picker");return t(),l(n,{show:d.show,columns:o(r),keyName:"name",onConfirm:f,onCancel:_,onChange:p},null,8,["show","columns"])}}},N=d({__name:"edit-address",setup(e){let a=n("编辑收货地址"),s=n(!1),d=n({id:null,contact_person:"",contact_phone:"",address:"",detail_address:"",is_default:2,is_default_address:!1,resolvedAddress:""});const E=n(null);i((e=>{const s=r().proxy;E.value=s.getOpenerEventChannel(),e&&e.title&&(a.value=e.title,d.value.is_default_address=0==e.addressLength),E.value.on("acceptDataFromOpenerPage",(function(e){if(e&&e.data){const{id:a=null,contact_person:s="",contact_phone:t="",detail_address:l="",address:o="",resolvedAddress:n="",is_default:i=2,is_default_address:r}=e.data;d.value={id:a,contact_person:s,contact_phone:t,detail_address:l,address:o,resolvedAddress:n,is_default:i,is_default_address:r}}}))}));const S=()=>{s.value=!0},z=e=>{const{value:a}=e;if(!a||!Array.isArray(a))return void console.warn("Picker value is invalid:",a);const t=a.map((e=>e&&e.name?e.name:"")).join("");if(t&&(d.value.resolvedAddress=t),4===a.length){const e=a[0]||{},s=a[1]||{},t=a[2]||{},l=a[3]||{},o=`${e.id||0}/${s.id||0}/${t.id||0}${l.id?"/"+l.id:""}`;d.value.address=o,console.log(o)}s.value=!1},B=async()=>{if(!d.value.contact_person)return x({title:"请填写收货人",icon:"none"});if(!d.value.contact_phone)return x({title:"请填写手机号",icon:"none"});if(!/^1[3-9]\d{9}$/.test(d.value.contact_phone))return x({title:"手机号格式错误",icon:"none"});if(!d.value.address)return x({title:"请选择区域",icon:"none"});if(!d.value.detail_address)return x({title:"请填写详细地址",icon:"none"});C({title:"提交中..."});try{const e={contact_person:d.value.contact_person,contact_phone:d.value.contact_phone,address:d.value.address,detail_address:d.value.detail_address,is_default:d.value.is_default_address?1:2};let a;d.value.id?(e.id=d.value.id,a=await y(e)):a=await A(e),V(),200===a.code?(x({title:"保存成功",icon:"success"}),E.value&&E.value.emit("acceptAddressUpdate",d.value),setTimeout((()=>{k()}),1500)):x({title:a.msg||"保存失败，请重试",icon:"none"})}catch(e){V(),console.error(e)}};return(e,n)=>{const i=c(u("LayoutNavigation"),P),r=j,x=F,C=f,y=c(u("u-icon"),_),A=U,V=c(u("u-switch"),m),k=c(u("CxComfirmBtn"),$),E=c(u("CxAreaPicker"),D);return t(),l(C,{class:"page-wrap edit-address"},{default:p((()=>[h(i,{title:o(a)},null,8,["title"]),h(C,{class:"page-content"},{default:p((()=>[h(C,{class:"form-container"},{default:p((()=>[h(C,{class:"form-item"},{default:p((()=>[h(r,{class:"label"},{default:p((()=>[v("收货人")])),_:1}),h(x,{class:"input",type:"text",modelValue:o(d).contact_person,"onUpdate:modelValue":n[0]||(n[0]=e=>o(d).contact_person=e),placeholder:"请填写收货人姓名","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),h(C,{class:"form-item"},{default:p((()=>[h(r,{class:"label"},{default:p((()=>[v("手机号")])),_:1}),h(x,{class:"input",type:"number",modelValue:o(d).contact_phone,"onUpdate:modelValue":n[1]||(n[1]=e=>o(d).contact_phone=e),placeholder:"请填写手机号码","placeholder-class":"placeholder",maxlength:"11"},null,8,["modelValue"])])),_:1}),h(C,{class:"form-item",onClick:S},{default:p((()=>[h(C,{class:"label-col"},{default:p((()=>[h(r,{class:"label"},{default:p((()=>[v("选择区域")])),_:1}),h(r,{class:g(["value",{placeholder:!o(d).resolvedAddress}])},{default:p((()=>[v(w(o(d).resolvedAddress||"省、市、区/县"),1)])),_:1},8,["class"])])),_:1}),h(y,{name:"arrow-right",color:"#999",size:"28rpx"})])),_:1}),h(C,{class:"form-item align-top"},{default:p((()=>[h(C,{class:"label-col"},{default:p((()=>[h(r,{class:"label"},{default:p((()=>[v("详细地址")])),_:1}),h(A,{class:"textarea",modelValue:o(d).detail_address,"onUpdate:modelValue":n[2]||(n[2]=e=>o(d).detail_address=e),placeholder:"街道、楼牌号等","placeholder-class":"placeholder","auto-height":""},null,8,["modelValue"])])),_:1})])),_:1}),h(C,{class:"form-item switch-item"},{default:p((()=>[h(r,{class:"label"},{default:p((()=>[v("设为默认")])),_:1}),h(V,{disabled:o(d).is_default_address,modelValue:o(d).is_default_address,"onUpdate:modelValue":n[3]||(n[3]=e=>o(d).is_default_address=e),activeColor:"#FF4D4F",size:"20"},null,8,["disabled","modelValue"])])),_:1})])),_:1}),h(C,{class:"submit-btn"},{default:p((()=>[h(k,{text:"提交",btnStyle:{background:"linear-gradient(90deg, #FF6034 0%, #EE0A24 100%)",color:"#fff",borderRadius:"44rpx",height:"88rpx",fontSize:"32rpx",border:"none"},onClick:B},null,8,["btnStyle"])])),_:1})])),_:1}),h(E,{show:o(s),"onUpdate:show":n[4]||(n[4]=e=>b(s)?s.value=e:s=e),onConfirm:z},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-558e39bb"]]);export{N as default};
