import{_ as a,r as e,af as t,c as l,d as s,a2 as n,C as r,D as o,g as i,j as u,f as c,u as d,H as m,F as p,P as g,J as f,m as v,a7 as _,as as k,aR as x,$ as h,o as y,k as b,t as S,av as C,at as w,aS as j,ae as V,p as z,A as F}from"./index-bLIxdInw.js";import{_ as L}from"./Navigation.DvAH-mKo.js";import{_ as U}from"./CxComfirmBtn.BhasumNO.js";import{_ as W}from"./CxModal.BSOB5gcq.js";const D=a({__name:"profile-edit",setup(a){const{proxy:D}=g();let P=D.getOpenerEventChannel(),R=e(null),B=e(!1),I={data:{url:""},code:-999,msg:""},M=t({avatar:"https://cdn.uviewui.com/uview/album/1.jpg",reg_ip:"56205620000",nickname:"会吃人的饭",signature:""}),N=e(!1),A=e("");const E=()=>{C({count:1,success:async a=>{console.log("选择图片成功:",a.tempFilePaths[0]),I=await w(a.tempFilePaths[0]);const{code:e=9999,data:t={},msg:l=""}=I;200===e?(f({title:"上传成功，等待审核",icon:"success"}),M.avatar=t.url):f({title:l||"上传失败，请重试",icon:"none"})}})},H=async()=>{try{const a=await j({avatar:I.data.url||"",nick_name:A.value||"",signature:M.signature||""}),{code:e=9999,data:t,msg:l}=a;200===e?(f({title:"已提交，等待审核",icon:"success"}),M.nickname=A.value||M.nickname,M.signature=M.signature||"",setTimeout((()=>{V({delta:1})}),1500)):f({title:l||"更新失败，请重试",icon:"none"})}catch(a){f({title:"更新失败，请重试",icon:"none"})}},J=l((()=>!(!B.value||!R.value)&&(M.avatar!==R.value.avatar||M.nickname!==R.value.nickname||M.signature!==R.value.signature))),K=()=>{A.value=M.nickname,N.value=!0},O=()=>{A.value.trim()?M.nickname=A.value:f({title:"昵称不能为空",icon:"none"})},Q=()=>{console.log("查看二维码")};return s((async()=>{R.value={avatar:M.avatar,nickname:M.nickname,signature:M.signature},B.value=!0})),n((()=>{P.on("sendUserData",(a=>{console.log("接收用户数据:",a),M.reg_ip=a.reg_ip,M.avatar=a.avatar,M.nickname=a.nick_name,M.signature=a.signature}))})),(a,e)=>{const t=r(o("LayoutNavigation"),L),l=z,s=v,n=r(o("u-cell"),_),g=r(o("u-cell-group"),k),f=F,C=r(o("u-textarea"),x),w=r(o("CxComfirmBtn"),U),j=r(o("u-input"),h),V=r(o("CxModal"),W);return y(),i(p,null,[u(s,{class:"page-wrap profile-edit"},{default:c((()=>[u(t,{title:"编辑资料"}),u(s,{class:"page-content"},{default:c((()=>[u(s,{class:"form-card"},{default:c((()=>[u(g,{border:!1},{default:c((()=>[u(n,{title:"头像",isLink:!0,onClick:E,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:c((()=>[u(s,{class:"avatar-wrap"},{default:c((()=>[u(l,{class:"avatar",src:d(M).avatar,mode:"aspectFill"},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),u(s,{class:"form-card mt-20"},{default:c((()=>[u(g,{border:!1},{default:c((()=>[u(n,{title:"ID",border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:c((()=>[u(f,{class:"id-text"},{default:c((()=>[b(S(d(M).reg_ip),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(s,{class:"form-card mt-20"},{default:c((()=>[u(g,{border:!1},{default:c((()=>[u(n,{title:"昵称",isLink:!0,onClick:K,border:!0,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:c((()=>[u(f,{class:"nickname-text"},{default:c((()=>[b(S(d(M).nickname),1)])),_:1})])),_:1}),u(n,{title:"我的二维码",isLink:!0,onClick:Q,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"})])),_:1})])),_:1}),u(s,{class:"form-card mt-20 signature-card"},{default:c((()=>[u(s,{class:"signature-title"},{default:c((()=>[b("个性签名")])),_:1}),u(C,{modelValue:d(M).signature,"onUpdate:modelValue":e[0]||(e[0]=a=>d(M).signature=a),placeholder:"这里是个性签名...",border:"none",maxlength:100,height:"200",customStyle:"background: transparent; padding: 0;"},null,8,["modelValue"])])),_:1}),u(s,{class:"mt-20 save-profile"},{default:c((()=>[u(w,{text:"保存",disabled:!d(J),onClick:H},null,8,["disabled"])])),_:1})])),_:1})])),_:1}),u(V,{show:d(N),"onUpdate:show":e[2]||(e[2]=a=>m(N)?N.value=a:N=a),title:"修改昵称",onConfirm:O},{default:c((()=>[u(s,{class:"input-wrap"},{default:c((()=>[u(j,{modelValue:d(A),"onUpdate:modelValue":e[1]||(e[1]=a=>m(A)?A.value=a:A=a),placeholder:"请输入昵称",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-59ddf840"]]);export{D as default};
