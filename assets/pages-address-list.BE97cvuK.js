import{_ as a,r as s,ai as e,O as t,x as d,y as l,g as o,j as n,f as c,u as r,B as i,F as _,ar as u,D as p,as as f,z as m,m as h,o as g,h as x,C as y,b as v,U as C,k,t as b,a1 as w,aq as A,an as j,at as z,ap as F,E,J as D}from"./index-E36eYFUz.js";import{_ as O}from"./Navigation.fXnM5b3z.js";import{_ as S}from"./uni-icons.DKvk8G6K.js";import{_ as B}from"./CxModal.B62FgOA2.js";import{g as L}from"./public.3bS5zsGE.js";import{_ as M}from"./CxComfirmBtn.D_Y-qTM9.js";import"./town._mydTJVR.js";const N=a({__name:"list",setup(a){let N=s(!1),U=null,q=s([]),I=s(!1);const J=D();e((a=>{"select"===a.mode&&(I.value=!0)}));t((()=>{(async()=>{try{const a=await u();if(0===a.code||200===a.code){const s=Array.isArray(a.data.lists)?a.data.lists:a.data&&a.data.data.lists?a.data.data.lists:[];Array.isArray(s)&&(q.value=s.map((a=>({id:a.id,contact_person:a.name||a.consignee||a.contact_person||"",contact_phone:a.phone||a.mobile||a.contact_phone||"",address:a.address||"",resolvedAddress:L(a.address),detail_address:a.detail||a.address_detail||a.detail_address||"",is_default:a.is_default,is_default_address:1==a.is_default}))))}}catch(a){console.error("获取地址列表失败",a)}})()}));const P=async()=>{const a=q.value[U];if(a.is_default_address)return p({title:"默认地址不能删除",icon:"none"});try{const s=await f({id:a.id});200===s.code||0===s.code?(q.value.splice(U,1),p({title:"地址已删除",icon:"none"}),N.value=!1):p({title:s.msg||"删除失败",icon:"none"})}catch(s){console.error(s),p({title:"删除失败",icon:"none"})}},$=()=>{y({url:`/pages/address/edit?title=新增收货地址&addressLength=${q.value.length}`})};return(a,s)=>{const e=d(l("LayoutNavigation"),O),t=d(l("u-icon"),m),u=E,f=h,D=d(l("uni-icons"),S),L=d(l("CxModal"),B);return g(),o(_,null,[n(f,{class:"page-wrap address-management"},{default:c((()=>[n(e,{title:"收货地址"}),n(f,{class:"page-content"},{default:c((()=>[n(f,{class:"address-list"},{default:c((()=>[(g(!0),o(_,null,x(r(q),((a,s)=>(g(),v(f,{class:C(["address-item",{checked:a.is_default_address}]),key:a.id,onClick:s=>(a=>{I.value&&(J.proxy.getOpenerEventChannel().emit("selectAddress",a),A())})(a)},{default:c((()=>[n(f,{class:"info-row"},{default:c((()=>[n(t,{name:"map",size:"32rpx",color:"#34332E",style:{"margin-right":"20rpx"}}),n(u,{class:"name"},{default:c((()=>[k(b(a.contact_person),1)])),_:2},1024),k("   "),n(u,{class:"phone"},{default:c((()=>[k(b(a.contact_phone),1)])),_:2},1024)])),_:2},1024),n(f,{class:"address-detail"},{default:c((()=>[k(b(a.resolvedAddress)+b(a.detail_address),1)])),_:2},1024),n(f,{class:"action-row"},{default:c((()=>[n(f,{class:"default-wrap",onClick:w((a=>(async a=>{const s=q.value[a];if(!s.is_default_address){j({title:"设置中..."});try{const e={id:s.id,contact_person:s.contact_person,contact_phone:s.contact_phone,address:s.address,detail_address:s.detail_address,is_default:1},t=await z(e);200===t.code||0===t.code?(p({title:"设置成功",icon:"success"}),q.value.forEach(((s,e)=>{e===a?(s.is_default=1,s.is_default_address=!0):(s.is_default=2,s.is_default_address=!1)}))):p({title:t.msg||"设置失败",icon:"none"})}catch(e){console.error(e),p({title:"设置失败",icon:"none"})}finally{F()}}})(s)),["stop"])},{default:c((()=>[n(f,{class:"radio-icon"},{default:c((()=>[a.is_default_address?(g(),v(t,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"30rpx"})):(g(),v(D,{key:1,type:"circle",color:"#ccc",size:"30rpx"})),k("   ")])),_:2},1024),n(u,{class:"default-text"},{default:c((()=>[k("默认地址")])),_:1})])),_:2},1032,["onClick"]),n(f,{class:"btn-group"},{default:c((()=>[n(f,{class:"btn-item"},{default:c((()=>[n(M,{text:"删除",onClick:a=>(a=>{N.value=!0,U=a})(s),btnStyle:{height:"60rpx",padding:"0rpx 50rpx",background:"none",color:"#ccc",borderColor:"#ccc"}},null,8,["onClick"])])),_:2},1024),n(f,{class:"btn-item"},{default:c((()=>[n(M,{text:"修改",onClick:s=>(a=>{y({url:"/pages/address/edit",success:s=>{s.eventChannel.emit("acceptDataFromOpenerPage",{data:{id:a.id,contact_person:a.contact_person,contact_phone:a.contact_phone,detail_address:a.detail_address,address:a.address,is_default:a.is_default,is_default_address:a.is_default_address,resolvedAddress:a.resolvedAddress}})}})})(a),btnStyle:{height:"60rpx",padding:"0rpx 50rpx"}},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),n(f,{class:"add-btn-wrap"},{default:c((()=>[n(M,{text:"新增收货地址",btnStyle:{height:"88rpx"},onClick:$})])),_:1})])),_:1})])),_:1}),n(L,{show:r(N),"onUpdate:show":s[0]||(s[0]=a=>i(N)?N.value=a:N=a),content:"确定删除该地址吗？",onConfirm:P},null,8,["show"])],64)}}},[["__scopeId","data-v-ebb28f68"]]);export{N as default};
