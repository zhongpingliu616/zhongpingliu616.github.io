import{_ as e}from"./Navigation.B6I6j3Nc.js";import{_ as t,c as a,a as s,C as l,D as o,o as n,b as r,f as i,j as u,k as d,t as c,n as m,u as f,g as p,F as b,l as _,A as v,m as g,p as x,r as A,w as y,d as C,$ as w,h,H as k,a0 as S,a1 as j,J as M,I as F,Q as I,a2 as L,P as U,W as D}from"./index-CFeN5XM9.js";import{_ as V}from"./CxTabs.C4IryxzZ.js";import{_ as B}from"./CxTag.c9OneOu4.js";import{_ as O}from"./CxComfirmBtn.BA1OBJ6W.js";import{_ as R}from"./ProductList.X_LjGJfO.js";import{_ as T}from"./CxModal.DjfFHvB7.js";const P=t({__name:"OrderManagementCard",props:{item:{type:Object,default:()=>({})}},emits:["action"],setup(e,{emit:t}){const A=t,y=e,C={padding:"0rpx 34rpx"},w={10:{text:"待支付",color:"#FF4D4F"},20:{text:"待发货",color:"#FA8C16"},30:{text:"待接受材料",color:"#1890FF"},40:{text:"待发成品",color:"#FA541C"},50:{text:"待接收成品",color:"#13C2C2"},60:{text:"待验收",color:"#722ED1"},70:{text:"验收成功",color:"#52C41A"},80:{text:"验收失败",color:"#A8071A"},90:{text:"取消订单",color:"#8C8C8C"}},h=a((()=>{var e;return(null==(e=w[y.item.status])?void 0:e.text)||"未知状态"})),k=a((()=>{var e;return(null==(e=w[y.item.status])?void 0:e.color)||"#333"})),S=e=>{A("action",{type:e,item:y.item})},j=()=>{A("action",{type:"detail",item:y.item})};return(t,a)=>{const A=v,y=g,w=s("up-col"),M=s("up-row"),F=x,I=l(o("CxTag"),B),L=l(o("CxComfirmBtn"),O);return n(),r(y,{key:e.item.id+Math.random(),class:"order-card-item",onClick:j},{default:i((()=>[u(y,{class:"order-status"},{default:i((()=>[u(M,{justify:"space-between",customStyle:"margin-bottom: 1rpx"},{default:i((()=>[u(w,{span:"9"},{default:i((()=>[u(y,{class:"order-id"},{default:i((()=>[u(A,{class:"order-id-text"},{default:i((()=>[d("订单号: "+c(e.item.order_id),1)])),_:1})])),_:1})])),_:1}),u(w,{span:"3"},{default:i((()=>[u(y,{class:"right-wrap"},{default:i((()=>[u(y,{class:"status-btn"},{default:i((()=>[u(A,{style:m({fontSize:"24rpx",color:f(k)})},{default:i((()=>[d(c(f(h)),1)])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(y,{class:"card-header"},{default:i((()=>[u(F,{src:e.item.image,class:"card-image",mode:"aspectFill"},null,8,["src"]),u(y,{class:"card-content"},{default:i((()=>[u(y,{class:"card-title"},{default:i((()=>[d(c(e.item.name),1)])),_:1}),u(y,{class:"tags"},{default:i((()=>[u(I,{text:e.item.period||"工期360天",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"]),d("  "),u(I,{text:e.item.difficulty||"难度低",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"])])),_:1}),u(y,{class:"bottom-row"},{default:i((()=>[u(A,{class:"cur-order-price"},{default:i((()=>[d(" ￥"+c(e.item.reward_amount||""),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(y,{class:"status-function-bts"},{default:i((()=>[10===e.item.status?(n(),p(b,{key:0},[u(y,{class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[0]||(a[0]=e=>S("cancel")),text:"取消订单"})])),_:1}),d("   "),u(y,{class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[1]||(a[1]=e=>S("pay")),text:"去支付"})])),_:1})],64)):20===e.item.status?(n(),r(y,{key:1,class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[2]||(a[2]=e=>S("remind")),text:"提醒发货"})])),_:1})):30===e.item.status?(n(),p(b,{key:2},[u(y,{class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[3]||(a[3]=e=>S("logistics")),text:"查看物流"})])),_:1}),d("   "),u(y,{class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[4]||(a[4]=e=>S("receivingMaterials")),text:"已收材料"})])),_:1}),d("   ")],64)):40===e.item.status?(n(),r(y,{key:3,class:"function-btn"},{default:i((()=>[u(L,{btnStyle:C,onClick:a[5]||(a[5]=e=>S("produced")),text:"制作完成"})])),_:1})):50===e.item.status?(n(),p(b,{key:4},[],64)):60===e.item.status?(n(),p(b,{key:5},[],64)):_("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-565c2b11"]]),z=t({__name:"OrderListComponent",props:{status:{type:[Number,Array],default:null}},setup(e){const t=e,a=A([]),s=A(!1),c=A(!1),m=A(1),_=A(10),v=A(!1),x=A("loadmore"),I=A("flower");let L=A(""),U=A(!1),D=A(!1),V=A(!1),B=A(!1),O={};const z=async(e=!1)=>{if(e&&(m.value=1,v.value=!1,c.value=!0,a.value=[]),!v.value||e){s.value=!0,x.value="loading";try{const l={page_no:m.value,page_size:_.value};null!==t.status&&void 0!==t.status&&(l.status=t.status);const o=await S(l);if(200===o.code||0===o.code){const t=o.data.lists||[];t.length<_.value&&(v.value=!0,x.value="nomore"),e?(a.value=t,e||(x.value="loadmore")):(a.value=[...a.value,...t],x.value=v.value?"loadmore":"nomore"),m.value++}else console.error("获取订单列表失败:",o.msg)}catch(l){e||(x.value="loadmore"),console.error("数据加载失败:",l)}finally{s.value=!1,c.value=!1}}},G=()=>{c.value=!0,z(!0)},E=()=>{s.value||v.value||z()},K=async()=>{const{msg:e,data:t,code:a}=await j({id:O.id,order_id:O.order_id,status:90});200===a?(M({title:"订单已取消",icon:"none"}),G()):M({title:e||"操作失败",icon:"none"})},N=async()=>{const{msg:e,data:t,code:a}=await j({id:O.id,order_id:O.order_id,status:40});200===a?(M({title:"已确认收到材料",icon:"none"}),G()):M({title:e||"操作失败",icon:"none"})},H=async()=>{if(!L.value)return void M({title:"请输入物流单号",icon:"none"});const{msg:e,data:t,code:a}=await j({id:O.id,order_id:O.order_id,status:50,finish_order_number:L.value});200===a?(M({title:"订单已完成",icon:"none"}),L.value="",G()):M({title:e||"操作失败",icon:"none"})},W=()=>{},X=({type:e,item:t})=>{switch(O=t,e){case"cancel":U.value=!0;break;case"pay":F({url:`/pages/xn/my/deposit?id=${t.id}&order_id=${t.order_id}`}),M({title:"跳转支付页面",icon:"none"});break;case"remind":M({title:"已提醒商家发货",icon:"success"}),window.location.href="https://www.baidu.com/s?wd=773394725450239";break;case"logistics":F({url:"https://www.baidu.com/s?wd=773394725450239",success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:O})}}),M({title:"查看物流详情",icon:"none"});break;case"receivingMaterials":V.value=!0;break;case"delete":B.value=!0;break;case"produced":D.value=!0;break;case"detail":F({url:"/pages/xn/orders/detail",success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:O})}})}};return y((()=>t.status),(()=>{G()})),C((()=>{z()})),(e,t)=>{const s=l(o("XnOrdersOrderManagementCard"),P),m=l(o("BaseProductList"),R),_=l(o("CxModal"),T),v=g,A=l(o("u-input"),w);return n(),p(b,null,[u(m,{onOnScrollToLower:E,onOnRefresh:G,isRefreshing:f(c),loadStatus:f(x),iconType:f(I),enableRefresh:!0,enableLoadMore:!0,class:"order-list"},{scrollContain:i((()=>[(n(!0),p(b,null,h(f(a),((e,t)=>(n(),r(s,{key:e.id,item:e,onAction:X},null,8,["item"])))),128))])),_:1},8,["isRefreshing","loadStatus","iconType"]),u(_,{show:f(U),"onUpdate:show":t[0]||(t[0]=e=>k(U)?U.value=e:U=e),content:"确定要取消订单吗？",onConfirm:K},null,8,["show"]),u(_,{show:f(V),"onUpdate:show":t[1]||(t[1]=e=>k(V)?V.value=e:V=e),content:"确认收材料了吗？",onConfirm:N},null,8,["show"]),u(_,{show:f(D),"onUpdate:show":t[3]||(t[3]=e=>k(D)?D.value=e:D=e),content:"确认完成了吗？",onConfirm:H},{default:i((()=>[u(v,{class:"input-wrap"},{default:i((()=>[u(v,{style:{"font-size":"28rpx",color:"#333","margin-bottom":"10rpx"}},{default:i((()=>[d("请输入物流单号,切勿填错")])),_:1}),u(A,{modelValue:f(L),"onUpdate:modelValue":t[2]||(t[2]=e=>k(L)?L.value=e:L=e),placeholder:"请输入你的物流单号",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"]),u(_,{show:f(B),"onUpdate:show":t[4]||(t[4]=e=>k(B)?B.value=e:B=e),content:"确定要删除订单吗？",onConfirm:W},null,8,["show"])],64)}}},[["__scopeId","data-v-2a84bb59"]]),G=t({__name:"order-management",setup(t){I((e=>({f42651b6:m})));let s=A("订单管理"),d=A(0);const{proxy:c}=U(),m=c.$safeAreaInfo.top+80+"rpx",p=[{name:"全部",status:null},{name:"待支付",status:10},{name:"待发货",status:20},{name:"待收材料",status:30},{name:"待发成品",status:40},{name:"待接收成品",status:50},{name:"待验收",status:60},{name:"验收成功",status:70},{name:"验收失败",status:80},{name:"已取消",status:90}];let b=A(p.map((e=>({name:e.name}))));const _=a((()=>p[d.value].status));return L((e=>{e.tabIndex&&(d.value=Number(e.tabIndex))})),(t,a)=>{const c=l(o("LayoutNavigation"),e),m=l(o("CxTabs"),V),p=l(o("XnOrdersOrderListComponent"),z),v=g;return n(),r(v,{class:"page-wrap order-management"},{default:i((()=>[u(c,{title:f(s)},null,8,["title"]),u(v,{class:"page-content"},{default:i((()=>[u(m,{tabItems:f(b),scrollable:!0,lineHeight:"5",lineWidth:"56rpx",itemStyle:{padding:"2rpx 25rpx"},activeStyle:{color:"#fff"},lineBg:f("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAICAMAAACMAFxIAAAAzFBMVEUAAAD4KBv/gFf5eVn4Kxz4LB35LB38elf8fVj8fVr7elj4Kx38fFn8elf8fVn4Khz4LR78elf8fVn4LR74Kx34LB74LR74Lh/4MCD4MSH4MiL4NCP5NST5Nyb5OSf5Oij5PCn5Piv5QCz5Qi75RC/5RjD5SDL5SjP6TDX6Tjb6UDj6Ujr6VDv6Vj36WD76WkD6XEH6XkP7YET7Ykb7ZEf7Zkn7aEr7akv7bE37bk77b0/7cVH7c1L8dFP8dlT8d1X8eFb8elf8e1j8fFlwxwMgAAAAFHRSTlMAJiYora2tra2tru7u8fHz8/Pz9A5jUGUAAABISURBVBgZlcFBDoAgDATAbW00QnyP/z9qvPAYawhU/QI7IxDLi4wq3kMkJWGcrtMKyj5rBikpWF1vkJrGA8pR7fO2GUZdUd8fzbgT1C1Y/jMAAAAASUVORK5CYII="),modelValue:f(d),"onUpdate:modelValue":a[0]||(a[0]=e=>k(d)?d.value=e:d=e),class:"order-management-tabs"},null,8,["tabItems","lineBg","modelValue"]),u(v,{class:"orders-list"},{default:i((()=>[(n(),r(D,null,[(n(),r(p,{status:f(_),key:f(d)},null,8,["status"]))],1024))])),_:1})])),_:1}),u(v)])),_:1})}}},[["__scopeId","data-v-33565a92"]]);export{G as default};
