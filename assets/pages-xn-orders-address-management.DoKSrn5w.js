import{_ as a,r as s,v as e,C as t,D as d,g as o,j as l,f as n,u as r,H as c,F as i,an as _,J as u,ao as p,E as f,m,o as h,h as g,I as x,b as y,y as v,k,t as C,Z as b,ah as w,ai as A,ak as j,A as F}from"./index-CRrG_siP.js";import{_ as S}from"./Navigation.CDuvAZ9P.js";import{_ as z}from"./uni-icons.cB7ZEcfD.js";import{_ as D}from"./CxModal.CGllcPVB.js";import{g as E}from"./public.D73yhEwY.js";import{_ as L}from"./CxComfirmBtn.BQaNQIo1.js";import"./town._mydTJVR.js";const I=a({__name:"address-management",setup(a){let I=s(!1),M=null,N=s([]);e((()=>{(async()=>{try{const a=await _();if(0===a.code||200===a.code){const s=Array.isArray(a.data.lists)?a.data.lists:a.data&&a.data.data.lists?a.data.data.lists:[];Array.isArray(s)&&(N.value=s.map((a=>({id:a.id,contact_person:a.name||a.consignee||a.contact_person||"",contact_phone:a.phone||a.mobile||a.contact_phone||"",address:a.address||"",resolvedAddress:E(a.address),detail_address:a.detail||a.address_detail||a.detail_address||"",is_default:a.is_default,is_default_address:1==a.is_default}))))}}catch(a){console.error("获取地址列表失败",a)}})()}));const B=async()=>{const a=N.value[M];if(a.is_default_address)return u({title:"默认地址不能删除",icon:"none"});try{const s=await p({id:a.id});200===s.code||0===s.code?(N.value.splice(M,1),u({title:"地址已删除",icon:"none"})):u({title:s.msg||"删除失败",icon:"none"})}catch(s){console.error(s),u({title:"删除失败",icon:"none"})}},H=()=>{x({url:`/pages/xn/orders/edit-address?title=新增收货地址&addressLength=${N.value.length}`})};return(a,s)=>{const e=t(d("LayoutNavigation"),S),_=t(d("u-icon"),f),p=F,E=m,J=t(d("uni-icons"),z),O=t(d("CxModal"),D);return h(),o(i,null,[l(E,{class:"page-wrap address-management"},{default:n((()=>[l(e,{title:"收货地址"}),l(E,{class:"page-content"},{default:n((()=>[l(E,{class:"address-list"},{default:n((()=>[(h(!0),o(i,null,g(r(N),((a,s)=>(h(),y(E,{class:v(["address-item",{checked:a.is_default_address}]),key:a.id},{default:n((()=>[l(E,{class:"info-row"},{default:n((()=>[l(_,{name:"map",size:"32rpx",color:"#34332E",style:{"margin-right":"20rpx"}}),l(p,{class:"name"},{default:n((()=>[k(C(a.contact_person),1)])),_:2},1024),k("   "),l(p,{class:"phone"},{default:n((()=>[k(C(a.contact_phone),1)])),_:2},1024)])),_:2},1024),l(E,{class:"address-detail"},{default:n((()=>[k(C(a.resolvedAddress)+C(a.detail_address),1)])),_:2},1024),l(E,{class:"action-row"},{default:n((()=>[l(E,{class:"default-wrap",onClick:b((a=>(async a=>{const s=N.value[a];if(!s.is_default_address){w({title:"设置中..."});try{const e={id:s.id,contact_person:s.contact_person,contact_phone:s.contact_phone,address:s.address,detail_address:s.detail_address,is_default:1},t=await A(e);200===t.code||0===t.code?(u({title:"设置成功",icon:"success"}),N.value.forEach(((s,e)=>{e===a?(s.is_default=1,s.is_default_address=!0):(s.is_default=2,s.is_default_address=!1)}))):u({title:t.msg||"设置失败",icon:"none"})}catch(e){console.error(e),u({title:"设置失败",icon:"none"})}finally{j()}}})(s)),["stop"])},{default:n((()=>[l(E,{class:"radio-icon"},{default:n((()=>[a.is_default_address?(h(),y(_,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"30rpx"})):(h(),y(J,{key:1,type:"circle",color:"#ccc",size:"40"})),k("   ")])),_:2},1024),l(p,{class:"default-text"},{default:n((()=>[k("默认地址")])),_:1})])),_:2},1032,["onClick"]),l(E,{class:"btn-group"},{default:n((()=>[l(E,{class:"btn-item"},{default:n((()=>[l(L,{text:"删除",onClick:b((a=>(a=>{I.value=!0,M=a})(s)),["stop"]),btnStyle:{height:"60rpx",padding:"0rpx 50rpx",background:"none",color:"#ccc",borderColor:"#ccc"}},null,8,["onClick"])])),_:2},1024),l(E,{class:"btn-item"},{default:n((()=>[l(L,{text:"修改",onClick:b((s=>(a=>{x({url:"/pages/xn/orders/edit-address",success:s=>{s.eventChannel.emit("acceptDataFromOpenerPage",{data:{id:a.id,contact_person:a.contact_person,contact_phone:a.contact_phone,detail_address:a.detail_address,address:a.address,is_default:a.is_default,is_default_address:a.is_default_address,resolvedAddress:a.resolvedAddress}})}})})(a)),["stop"]),btnStyle:{height:"60rpx",padding:"0rpx 50rpx"}},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),l(E,{class:"add-btn-wrap"},{default:n((()=>[l(L,{text:"新增收货地址",btnStyle:{height:"88rpx"},onClick:H})])),_:1})])),_:1})])),_:1}),l(O,{show:r(I),"onUpdate:show":s[0]||(s[0]=a=>c(I)?I.value=a:I=a),content:"确定删除该地址吗？",onConfirm:B},null,8,["show"])],64)}}},[["__scopeId","data-v-d1e93f2d"]]);export{I as default};
