import{_ as e,K as o,r as a,au as t,x as s,y as l,b as n,f as c,J as i,Z as r,m as d,z as p,o as u,j as m,u as f,k as h,t as g,l as y,n as _,aD as v,D as w,P as x,aE as C,p as V,E as z}from"./index-E36eYFUz.js";import{_ as N}from"./Navigation.fXnM5b3z.js";import{_ as b}from"./uni-icons.DKvk8G6K.js";import{_ as k}from"./CxComfirmBtn.D_Y-qTM9.js";import{_ as P}from"./zhanghao.BgAr4qWD.js";import{_ as $,a as j}from"./emiyanzhengma.C1RAKEWA.js";import{_ as U}from"./mima.CnEZst9Z.js";const A=e({__name:"regist",setup(e){o((e=>({"0be3422c":F})));const{proxy:A}=i(),F=A.$safeAreaInfo.top+80+"rpx";let I=a("注册用户"),Z=a(!1);const B=t({accoutName:"",phone:"",code:"",invitationCode:"",password:"",confirmPassword:""}),D=t({accoutName:"",phone:"",code:"",password:"",confirmPassword:""}),E=e=>{D[e]="",Z.value=!1},K=async()=>{if((()=>{var e,o,a;let t=!0;const s=null==(e=B.accoutName)?void 0:e.trim();s?s.length<6||s.length>20?(D.accoutName="账户名字母开头6-20位",t=!1):/^[a-zA-Z][a-zA-Z0-9]*$/.test(s)||(D.accoutName="字母开头且仅包含字母数字",t=!1):(D.accoutName="用户名不能为空",t=!1),B.phone?/^1[3-9]\d{9}$/.test(B.phone)||(D.phone="手机号格式不正确",t=!1):(D.phone="手机号不能为空",t=!1),B.code?6!=`${B.code}`.trim().length&&(D.code="验证码格式不正确",t=!1):(D.code="验证码不能为空",t=!1);const l=B.password;return l?l.length<6||l.length>20?(D.password="密码长度6-20位",t=!1):/^[A-Za-z]/.test(l)||(D.password="密码必须字母开头",t=!1):(D.password="密码不能为空",t=!1),B.confirmPassword?B.confirmPassword!==l&&(D.confirmPassword="两次输入的密码不一致",t=!1):(D.confirmPassword="请再次输入密码",t=!1),1!=(null==(o=A.$globalConfig)?void 0:o.reg_invite_check)||B.invitationCode?1==(null==(a=A.$globalConfig)?void 0:a.reg_invite_check)&&`${B.invitationCode}`.trim().length<6&&(D.invitationCode="邀请码格式不正确",t=!1):(D.invitationCode="邀请码不能为空",t=!1),t})()){Z.value=!0;try{const e=await v({username:B.accoutName,password:B.password,phone:B.phone,sms_code:B.code,confirm_password:B.confirmPassword});200===e.code?(w({title:"注册成功！",icon:"success"}),setTimeout((()=>{x({url:"/pages/login?role=XN"})}),1500)):w({title:e.msg||"注册失败",icon:"none"})}catch(e){console.error("注册失败",e),w({title:e.msg||"注册失败",icon:"none"})}finally{Z.value=!1}}},q=a(!1),H=a(!1),J=a(!1),L=a(60),T=async()=>{if(!J.value)if(B.phone)if(/^1[3-9]\d{9}$/.test(B.phone))try{const e=await C({phone:B.phone,type:1});if(200===e.code){w({title:"验证码已发送",icon:"success"}),J.value=!0,B.code=e.data.sms_code;const o=setInterval((()=>{L.value--,L.value<=0&&(clearInterval(o),J.value=!1,L.value=60)}),1e3)}else w({title:e.msg||"发送失败",icon:"none"})}catch(e){console.error("发送验证码失败",e),w({title:e.msg||"发送失败",icon:"none"})}else D.phone="请输入正确的手机号";else D.phone="请输入手机号"},W=()=>{q.value=!q.value},X=()=>{H.value=!H.value};return(e,o)=>{const a=s(l("LayoutNavigation"),N),t=V,i=s(l("u-input"),r),v=z,w=d,x=s(l("u-icon"),p),C=s(l("uni-icons"),b),A=s(l("CxComfirmBtn"),k);return u(),n(w,{class:"page-wrap index"},{default:c((()=>[m(a,{title:f(I)},null,8,["title"]),m(w,{class:"page-content"},{default:c((()=>[m(w,{class:"container"},{default:c((()=>[m(w,{class:"input-item"},{default:c((()=>[m(t,{class:"input-icon",src:P,mode:"aspectFit"}),m(i,{modelValue:f(B).accoutName,"onUpdate:modelValue":[o[0]||(o[0]=e=>f(B).accoutName=e),o[1]||(o[1]=e=>E("accoutName"))],placeholder:"账户名字母开头6-20非中文字符",type:"text",border:"none",maxlength:"11","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),f(D).accoutName?(u(),n(v,{key:0,class:"error-text"},{default:c((()=>[h(g(f(D).accoutName),1)])),_:1})):y("",!0)])),_:1}),m(w,{class:"input-item"},{default:c((()=>[m(t,{class:"input-icon",src:$,mode:"aspectFit"}),m(i,{modelValue:f(B).phone,"onUpdate:modelValue":[o[2]||(o[2]=e=>f(B).phone=e),o[3]||(o[3]=e=>E("phone"))],placeholder:"请输入您的手机号码",type:"number",border:"none",maxlength:"11","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),f(D).phone?(u(),n(v,{key:0,class:"error-text"},{default:c((()=>[h(g(f(D).phone),1)])),_:1})):y("",!0)])),_:1}),m(w,{class:"input-item"},{default:c((()=>[m(t,{class:"input-icon",src:j,mode:"aspectFit"}),m(i,{modelValue:f(B).code,"onUpdate:modelValue":[o[4]||(o[4]=e=>f(B).code=e),o[5]||(o[5]=e=>E("code"))],placeholder:"请输入验证码",type:"text",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),f(D).code?y("",!0):(u(),n(v,{key:0,onClick:T,class:"verify-btn",style:_({color:f(J)?"#ccc":"#ff4d4d",fontWeight:"normal"})},{default:c((()=>[h(g(f(J)?`${f(L)}s后重试`:"获取验证码"),1)])),_:1},8,["style"])),f(D).code?(u(),n(v,{key:1,class:"error-text"},{default:c((()=>[h(g(f(D).code),1)])),_:1})):y("",!0)])),_:1}),m(w,{class:"input-item"},{default:c((()=>[m(t,{class:"input-icon",src:U,mode:"aspectFit"}),m(i,{modelValue:f(B).password,"onUpdate:modelValue":[o[6]||(o[6]=e=>f(B).password=e),o[7]||(o[7]=e=>E("password"))],placeholder:"字母开头,必须包含特殊字符6-20位",type:f(q)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),m(x,{name:f(q)?"eye":"",size:"36",color:"#999",onClick:W},null,8,["name"]),f(D).password?(u(),n(v,{key:0,class:"error-text"},{default:c((()=>[h(g(f(D).password),1)])),_:1})):y("",!0)])),_:1}),m(w,{class:"input-item"},{default:c((()=>[m(t,{class:"input-icon",src:U,mode:"aspectFit"}),m(i,{modelValue:f(B).confirmPassword,"onUpdate:modelValue":[o[8]||(o[8]=e=>f(B).confirmPassword=e),o[9]||(o[9]=e=>E("confirmPassword"))],placeholder:"请再次输入密码",type:f(H)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),m(x,{name:f(H)?"eye":"",size:"36",color:"#999",onClick:X},null,8,["name"]),f(D).confirmPassword?(u(),n(v,{key:0,class:"error-text"},{default:c((()=>[h(g(f(D).confirmPassword),1)])),_:1})):y("",!0)])),_:1}),m(w,{class:"input-item"},{default:c((()=>[m(C,{"custom-prefix":"iconfont",type:"icon-yaoqingma",size:"40rpx",color:"#6a4445"}),m(i,{modelValue:f(B).invitationCode,"onUpdate:modelValue":o[10]||(o[10]=e=>f(B).invitationCode=e),placeholder:"请输入邀请码",type:"text",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),f(D).invitationCode?(u(),n(v,{key:0,class:"error-text"},{default:c((()=>[h(g(f(D).invitationCode),1)])),_:1})):y("",!0)])),_:1})])),_:1}),m(w,{class:"regist-btn-wrap"},{default:c((()=>[m(A,{text:"确认注册",loading:f(Z),onClick:K},null,8,["loading"])])),_:1})])),_:1}),m(w)])),_:1})}}},[["__scopeId","data-v-bdf99584"]]);export{A as default};
