import{_ as a,r as s,v as e,C as t,D as d,g as l,j as o,f as r,u as n,H as c,F as i,al as _,E as u,m as p,o as f,h as m,I as h,b as g,y as x,k as y,t as v,X as k,af as C,ag as b,J as w,ai as A,A as j}from"./index-Cklw5-2D.js";import{_ as F}from"./Navigation.DJK0J8h_.js";import{_ as z}from"./uni-icons.BSAxfIEl.js";import{_ as D}from"./CxModal.C_EAuDKr.js";import{g as E}from"./public.D73yhEwY.js";import{_ as S}from"./CxComfirmBtn.C_6MRR7B.js";import"./town._mydTJVR.js";const I=a({__name:"address-management",setup(a){let I=s(!1),L=null,M=s([]);e((()=>{(async()=>{try{const a=await _();if(0===a.code||200===a.code){const s=Array.isArray(a.data.lists)?a.data.lists:a.data&&a.data.data.lists?a.data.data.lists:[];Array.isArray(s)&&(M.value=s.map((a=>({id:a.id,contact_person:a.name||a.consignee||a.contact_person||"",contact_phone:a.phone||a.mobile||a.contact_phone||"",address:a.address||"",resolvedAddress:E(a.address),detail_address:a.detail||a.address_detail||a.detail_address||"",is_default:a.is_default,is_default_address:1==a.is_default}))))}}catch(a){console.error("获取地址列表失败",a)}})()}));const N=async()=>{M.value[L]},U=()=>{h({url:`/pages/xn/orders/edit-address?title=新增收货地址&addressLength=${M.value.length}`})};return(a,s)=>{const e=t(d("LayoutNavigation"),F),_=t(d("u-icon"),u),E=j,B=p,H=t(d("uni-icons"),z),J=t(d("CxModal"),D);return f(),l(i,null,[o(B,{class:"page-wrap address-management"},{default:r((()=>[o(e,{title:"收货地址"}),o(B,{class:"page-content"},{default:r((()=>[o(B,{class:"address-list"},{default:r((()=>[(f(!0),l(i,null,m(n(M),((a,s)=>(f(),g(B,{class:x(["address-item",{checked:a.is_default_address}]),key:a.id},{default:r((()=>[o(B,{class:"info-row"},{default:r((()=>[o(_,{name:"map",size:"32rpx",color:"#34332E",style:{"margin-right":"20rpx"}}),o(E,{class:"name"},{default:r((()=>[y(v(a.contact_person),1)])),_:2},1024),y("   "),o(E,{class:"phone"},{default:r((()=>[y(v(a.contact_phone),1)])),_:2},1024)])),_:2},1024),o(B,{class:"address-detail"},{default:r((()=>[y(v(a.resolvedAddress)+v(a.detail_address),1)])),_:2},1024),o(B,{class:"action-row"},{default:r((()=>[o(B,{class:"default-wrap",onClick:k((a=>(async a=>{const s=M.value[a];if(!s.is_default_address){C({title:"设置中..."});try{const e={id:s.id,contact_person:s.contact_person,contact_phone:s.contact_phone,address:s.address,detail_address:s.detail_address,is_default:1},t=await b(e);200===t.code||0===t.code?(w({title:"设置成功",icon:"success"}),M.value.forEach(((s,e)=>{e===a?(s.is_default=1,s.is_default_address=!0):(s.is_default=2,s.is_default_address=!1)}))):w({title:t.msg||"设置失败",icon:"none"})}catch(e){console.error(e),w({title:"设置失败",icon:"none"})}finally{A()}}})(s)),["stop"])},{default:r((()=>[o(B,{class:"radio-icon"},{default:r((()=>[a.is_default_address?(f(),g(_,{key:0,name:"checkmark-circle-fill",color:"#FF4D4F",size:"30rpx"})):(f(),g(H,{key:1,type:"circle",color:"#ccc",size:"40"})),y("   ")])),_:2},1024),o(E,{class:"default-text"},{default:r((()=>[y("默认地址")])),_:1})])),_:2},1032,["onClick"]),o(B,{class:"btn-group"},{default:r((()=>[o(B,{class:"btn-item"},{default:r((()=>[o(S,{text:"删除",onClick:k((a=>(a=>{alert(a),I.value=!0,L=a})(s)),["stop"]),btnStyle:{height:"60rpx",padding:"0rpx 50rpx",background:"none",color:"#ccc",borderColor:"#ccc"}},null,8,["onClick"])])),_:2},1024),o(B,{class:"btn-item"},{default:r((()=>[o(S,{text:"修改",onClick:k((s=>(a=>{h({url:"/pages/xn/orders/edit-address",success:s=>{s.eventChannel.emit("acceptDataFromOpenerPage",{data:{id:a.id,contact_person:a.contact_person,contact_phone:a.contact_phone,detail_address:a.detail_address,address:a.address,is_default:a.is_default,is_default_address:a.is_default_address,resolvedAddress:a.resolvedAddress}})}})})(a)),["stop"]),btnStyle:{height:"60rpx",padding:"0rpx 50rpx"}},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),o(B,{class:"add-btn-wrap"},{default:r((()=>[o(S,{text:"新增收货地址",btnStyle:{height:"88rpx"},onClick:U})])),_:1})])),_:1})])),_:1}),o(J,{show:n(I),"onUpdate:show":s[0]||(s[0]=a=>c(I)?I.value=a:I=a),content:"确定删除该地址吗？",onConfirm:N},null,8,["show"])],64)}}},[["__scopeId","data-v-e9a69cfa"]]);export{I as default};
