import{_ as a,R as e,r as l,d as s,w as o,Z as r,v as t,a as n,C as u,D as c,b as i,f as d,Q as m,M as v,N as f,J as p,m as _,o as g,j as h,k as C,u as x,H as b,g as w,h as y,F as T,A as j,I as R,P as I}from"./index-DiJpDbC3.js";import{_ as L}from"./OrderCard.6XbY4em8.js";import{_ as O}from"./ProductList.BN8gitTL.js";import{_ as S}from"./CustomBarXn.BicbHWaR.js";import"./CxTag.DaRaAxA3.js";import"./CxComfirmBtn.CPDBkoVY.js";const k=a({__name:"index",setup(a){e((a=>({"3b47f3a0":B})));const{proxy:k}=m(),B=k.$safeAreaInfo.top+24+"rpx";l("orders");let D=l("");const A=function(a,e=1500){let l=null;const s=()=>{l&&clearTimeout(l),l=setTimeout(a,e)};return s.cancel=()=>{l&&(clearTimeout(l),l=null)},s}((()=>{E(!0)}),1600);l(3);const F=l([]),M=l(!1),P=l(!1),V=l(1),X=l(10),$=l(!1),H=l("loadmore"),J=l("flower");let z=l({});const E=async(a=!1)=>{if((!M.value||a)&&(!P.value||a)&&(!$.value||a)){a?(V.value=1,$.value=!1,P.value=!0,H.value="loading"):(M.value=!0,H.value="loading");try{const e=await v({page_no:V.value,page_size:X.value,keyword:D.value}),l=200===e.code&&e.data.lists||[];l.length<X.value?($.value=!0,H.value="nomore"):H.value="loadmore",a?(F.value=l,f()):F.value=[...F.value,...l],V.value++}catch(e){H.value="loadmore",console.error("数据加载失败:",e),p({title:"加载失败",icon:"none"})}finally{M.value=!1,P.value=!1}}},G=()=>{P.value||E(!0)},K=()=>{M.value||$.value||E()},N=a=>{R({url:`/pages/xn/collection-detail/index?id=${a.id}`})},Q=(a,e)=>{(async a=>{if(!a)return void p({title:"订单ID不能为空",icon:"none"});const{code:e,msg:l,data:s={}}=await I({id:a});200==e?(p({title:"订单创建成功",icon:"success"}),z.value=s.lists||{},z.value.id=a,setTimeout((()=>{R({url:`/pages/xn/my/deposit?id=${a}`,success:a=>{a.eventChannel.emit("sendMarginDatas",{marginResultData:z.value})},fail:a=>{console.error("跳转失败",a)}})}),1500)):p({title:l||"订单创建失败",icon:"none"})})(a.id)};s((()=>{E(!0)})),o(D,(a=>{A()}));const U=()=>{A()};return r((()=>{A&&A.cancel&&A.cancel()})),t((()=>{})),(a,e)=>{const l=_,s=j,o=n("up-col"),r=n("up-search"),t=n("up-row"),m=u(c("XnOrdersOrderCard"),L),v=u(c("BaseProductList"),O),f=u(c("LayoutCustomBarXn"),S);return g(),i(l,{class:"page-wrap orders"},{default:d((()=>[h(l),h(l,{class:"page-content"},{default:d((()=>[h(l,{class:"order-search"},{default:d((()=>[h(t,{customStyle:"margin-bottom: 10px"},{default:d((()=>[h(o,{span:"2"},{default:d((()=>[h(l,{class:"order-text-wrap"},{default:d((()=>[h(s,{class:"order-text"},{default:d((()=>[C("订单")])),_:1})])),_:1})])),_:1}),h(o,{span:"9"},{default:d((()=>[h(l,{class:"search-bar"},{default:d((()=>[h(r,{modelValue:x(D),"onUpdate:modelValue":e[0]||(e[0]=a=>b(D)?D.value=a:D=a),placeholder:"输入搜索内容",bgColor:"#fff",placeholderColor:"#AC9394",searchIconColor:"#672227",borderColor:"#FFE185",height:"66rpx",onSearch:U,"show-action":!1,clearabled:""},null,8,["modelValue"])])),_:1})])),_:1}),h(o,{span:"1"})])),_:1})])),_:1}),h(l,{class:"order-list"},{default:d((()=>[h(l,{class:"order-container"},{default:d((()=>[h(v,{onOnScrollToLower:K,onOnRefresh:G,isRefreshing:x(P),loadStatus:x(H),iconType:x(J),enableRefresh:!0,enableLoadMore:!0,class:"scroll-view"},{scrollContain:d((()=>[(g(!0),w(T,null,y(x(F),((a,e)=>(g(),i(m,{item:a,onGrabOrderClick:Q,onHandleItemClick:N},null,8,["item"])))),256))])),_:1},8,["isRefreshing","loadStatus","iconType"])])),_:1})])),_:1})])),_:1}),h(f)])),_:1})}}},[["__scopeId","data-v-37e85b41"]]);export{k as default};
