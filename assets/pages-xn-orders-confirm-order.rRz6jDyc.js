import{_ as a,r as e,c as s,ai as t,ar as l,x as d,y as r,b as c,f as o,J as i,z as n,m as u,o as f,j as _,u as p,k as m,t as g,C as v,D as x,H as y,E as h,p as w}from"./index-E36eYFUz.js";import{_ as F}from"./Navigation.fXnM5b3z.js";import{_ as b}from"./CxTag.DU_-stGW.js";import{_ as C}from"./CxComfirmBtn.D_Y-qTM9.js";import{g as j}from"./public.3bS5zsGE.js";import{f as A,v as k}from"./xn.B6pvNNd_.js";import"./town._mydTJVR.js";const E=a({__name:"confirm-order",setup(a){let E=e("确认订单"),D=e(!1),z=e({}),B=e({}),G=null;e("30000"),s((()=>((parseFloat(z.value.deposit)||0)+(parseFloat(z.value.freight)||0)).toFixed(2))),t((a=>{a.id&&(G=a.id,N(G)),O();const e=i();if(e&&e.proxy){const a=e.proxy.getOpenerEventChannel();a&&a.on("sendOrderData",(a=>{a.marginResultData&&(z.value=a.marginResultData)}))}}));const N=async a=>{try{const e=await A({id:a});if(200===e.code||0===e.code){const a=e.data||{};z.value={image:a.image||"",title:a.title||"商品名称",duration:a.duration||"30天",level:a.level_name||"等级",price:a.price||"0.00",deposit:a.deposit||"0.00",freight:a.freight||"0.00"}}}catch(e){console.error("获取详情失败",e),z.value={}}},O=async()=>{try{const a=await l();if(200===a.code||0===a.code){const e=Array.isArray(a.data.lists)?a.data.lists:a.data&&a.data.data.lists?a.data.data.lists:[];if(e.length>0){const a=e.find((a=>1==a.is_default))||e[0];R(a)}}}catch(a){console.error("获取地址失败",a)}},R=a=>{B.value={id:a.id,contact_person:a.name||a.consignee||a.contact_person||"",contact_phone:a.phone||a.mobile||a.contact_phone||"",address:a.address||"",resolvedAddress:j(a.address),detail_address:a.detail||a.address_detail||a.detail_address||""}},S=()=>{v({url:"/pages/address/list?mode=select",events:{selectAddress:a=>{R(a)}}})},T=async()=>{if(B.value.id&&B.value.contact_phone&&B.value.contact_person&&B.value.detail_address){x({title:"正在支付？",icon:"none"}),D.value=!0;try{const a={order_id:z.value.order_id,address_id:B.value.id},e=await k(a);if(200===e.code||0===e.code){e.data.order_id||e.data.id;y({url:"/pages/xn/orders/index"})}else x({title:e.msg||"下单失败",icon:"none"})}catch(a){console.error("下单异常",a),x({title:"下单失败",icon:"none"})}finally{D.value=!1}}else x({title:"请选择地址信息",icon:"none"})};return(a,e)=>{const s=d(r("LayoutNavigation"),F),t=d(r("u-icon"),n),l=u,i=h,v=w,x=d(r("CxTag"),b),y=d(r("CxComfirmBtn"),C);return f(),c(l,{class:"page-wrap confirm-order"},{default:o((()=>[_(s,{title:p(E)},null,8,["title"]),_(l,{class:"page-content"},{default:o((()=>[_(l,{class:"info-card address-card",onClick:S},{default:o((()=>[_(l,{class:"left-icon"},{default:o((()=>[_(l,{class:"icon-circle"},{default:o((()=>[_(t,{name:"map-fill",color:"#fff",size:"40rpx"})])),_:1})])),_:1}),p(B).id?(f(),c(l,{key:0,class:"address-info"},{default:o((()=>[_(l,{class:"user-row"},{default:o((()=>[_(i,{class:"name"},{default:o((()=>[m(g(p(B).contact_person),1)])),_:1}),_(i,{class:"phone"},{default:o((()=>[m(g(p(B).contact_phone),1)])),_:1})])),_:1}),_(l,{class:"addr-text"},{default:o((()=>[m(g(p(B).resolvedAddress)+g(p(B).detail_address),1)])),_:1})])),_:1})):(f(),c(l,{key:1,class:"address-info"},{default:o((()=>[_(i,{class:"placeholder"},{default:o((()=>[m("请选择收货地址")])),_:1})])),_:1})),_(l,{class:"right-icon"},{default:o((()=>[_(t,{name:"arrow-right",color:"#999",size:"28rpx"})])),_:1})])),_:1}),_(l,{class:"info-card order-info-card"},{default:o((()=>[_(l,{class:"card-title-row"},{default:o((()=>[_(l,{class:"red-bar"}),_(i,{class:"card-title"},{default:o((()=>[m("订单信息")])),_:1})])),_:1}),_(l,{class:"product-item"},{default:o((()=>[_(v,{class:"product-img",src:p(z).image,mode:"aspectFill"},null,8,["src"]),_(l,{class:"product-details"},{default:o((()=>[_(l,{class:"product-title"},{default:o((()=>[m(g(p(z).name),1)])),_:1}),_(l,{class:"product-tags"},{default:o((()=>[_(x,{shape:"circle",text:p(z).period,textStyle:{color:"#4A90E2"},bgGradient:["#E8F3FF","#E8F3FF"]},null,8,["text"]),_(x,{shape:"circle",textStyle:{color:"#999"},text:p(z).difficulty,bgGradient:["#F5F5F5","#F5F5F5"]},null,8,["text"])])),_:1}),_(l,{class:"product-price-row"},{default:o((()=>[_(i,{class:"price"},{default:o((()=>[m("¥ "+g(p(z).reward_amount),1)])),_:1}),_(i,{class:"count"},{default:o((()=>[m("x 1")])),_:1})])),_:1})])),_:1})])),_:1}),_(l,{class:"summary-row"},{default:o((()=>[_(i,{class:"label"},{default:o((()=>[m("订单押金 (共1件)")])),_:1}),_(i,{class:"value"},{default:o((()=>[m("¥ "+g(p(z).deposit||"0.00"),1)])),_:1})])),_:1}),_(l,{class:"summary-row"},{default:o((()=>[_(i,{class:"label"},{default:o((()=>[m("运费")])),_:1}),_(i,{class:"value"},{default:o((()=>[m("¥ "+g(p(z).shipping_fee||"0.00"),1)])),_:1})])),_:1}),_(l,{class:"divider"}),_(l,{class:"summary-row total-row"},{default:o((()=>[_(i,{class:"label"},{default:o((()=>[m("订单总价")])),_:1}),_(i,{class:"value total-price"},{default:o((()=>[m("¥ "+g(p(z).final_amount),1)])),_:1})])),_:1})])),_:1}),_(l,{class:"info-card link-card"},{default:o((()=>[_(l,{class:"card-title-row"},{default:o((()=>[_(l,{class:"red-bar"}),_(i,{class:"card-title"},{default:o((()=>[m("缴纳方式")])),_:1})])),_:1}),_(l,{class:"right-action"},{default:o((()=>[_(i,null,{default:o((()=>[m("账户余额")])),_:1})])),_:1})])),_:1}),_(l,{class:"info-card deduction-card"},{default:o((()=>[_(l,{class:"card-title-row"},{default:o((()=>[_(l,{class:"red-bar"}),_(i,{class:"card-title"},{default:o((()=>[m("保证金减免")])),_:1})])),_:1}),_(l,{class:"deduction-desc"},{default:o((()=>[_(l,{class:"main-text"},{default:o((()=>[m("使用“保证金减免额度” （可抵扣"+g(p(z).deposit_reduction_amount)+"元）",1)])),_:1}),_(l,{class:"sub-text"},{default:o((()=>[m("分享邀请二维码邀请好友注册并认证可获取“押金减免额度”")])),_:1})])),_:1})])),_:1})])),_:1}),_(l,{class:"bottom-bar"},{default:o((()=>[_(y,{text:"确定",loading:p(D),onClick:T},null,8,["loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-b4ee2f98"]]);export{E as default};
