import{_ as e}from"./Navigation.nOf0Yq_M.js";import{_ as t,c as a,a as s,C as l,D as o,o as n,b as r,f as i,j as u,$ as d,k as c,t as m,n as f,u as p,g as v,F as _,l as b,A as g,m as x,p as A,r as y,w as C,a0 as w,d as h,a1 as k,h as S,H as j,a2 as D,a3 as M,J as I,I as F,a4 as U,a5 as L,R,a6 as V,Q as B,X as T}from"./index-vfEMzM-K.js";import{_ as O}from"./CxTabs.BuZsnMPq.js";import{_ as z}from"./CxTag.C--koTks.js";import{_ as P}from"./CxComfirmBtn.DxLwN25C.js";import{_ as G}from"./ProductList.1dLVyph-.js";import{_ as E}from"./CxModal.CrTqJ3JN.js";const K=t({__name:"OrderManagementCard",props:{item:{type:Object,default:()=>({})}},emits:["action"],setup(e,{emit:t}){const y=t,C=e,w={padding:"0rpx 34rpx"},h={10:{text:"待支付",color:"#FF4D4F"},20:{text:"待发货",color:"#FA8C16"},30:{text:"待接受材料",color:"#1890FF"},40:{text:"待发成品",color:"#FA541C"},50:{text:"待接收成品",color:"#13C2C2"},60:{text:"待验收",color:"#722ED1"},70:{text:"验收成功",color:"#52C41A"},80:{text:"验收失败",color:"#A8071A"},90:{text:"取消订单",color:"#8C8C8C"}},k=a((()=>{var e;return(null==(e=h[C.item.status])?void 0:e.text)||"未知状态"})),S=a((()=>{var e;return(null==(e=h[C.item.status])?void 0:e.color)||"#333"})),j=e=>{y("action",{type:e,item:C.item})},D=()=>{y("action",{type:"detail",item:C.item})};return(t,a)=>{const y=g,C=x,h=s("up-col"),M=s("up-row"),I=A,F=l(o("CxTag"),z),U=l(o("CxComfirmBtn"),P);return n(),r(C,{key:e.item.id+Math.random(),class:"order-card-item"},{default:i((()=>[u(C,{class:"order-status",onClick:d(D,["stop"])},{default:i((()=>[u(M,{justify:"space-between",customStyle:"margin-bottom: 1rpx"},{default:i((()=>[u(h,{span:"9"},{default:i((()=>[u(C,{class:"order-id"},{default:i((()=>[u(y,{class:"order-id-text"},{default:i((()=>[c("订单号: "+m(e.item.order_id),1)])),_:1})])),_:1})])),_:1}),u(h,{span:"3"},{default:i((()=>[u(C,{class:"right-wrap"},{default:i((()=>[u(C,{class:"status-btn"},{default:i((()=>[u(y,{style:f({fontSize:"24rpx",color:p(S)})},{default:i((()=>[c(m(p(k)),1)])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"card-header"},{default:i((()=>[u(I,{src:e.item.image,class:"card-image",mode:"aspectFill"},null,8,["src"]),u(C,{class:"card-content"},{default:i((()=>[u(C,{class:"card-title"},{default:i((()=>[c(m(e.item.name),1)])),_:1}),u(C,{class:"tags"},{default:i((()=>[u(F,{text:e.item.period||"工期360天",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"]),c("  "),u(F,{text:e.item.difficulty||"难度低",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"])])),_:1}),u(C,{class:"bottom-row"},{default:i((()=>[u(y,{class:"cur-order-price"},{default:i((()=>[c(" ￥"+m(e.item.reward_amount||""),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"status-function-bts"},{default:i((()=>[10===e.item.status?(n(),v(_,{key:0},[u(C,{class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[0]||(a[0]=d((e=>j("cancel")),["stop"])),text:"取消订单"})])),_:1}),c("   "),u(C,{class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[1]||(a[1]=d((e=>j("pay")),["stop"])),text:"去支付"})])),_:1})],64)):20===e.item.status?(n(),r(C,{key:1,class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[2]||(a[2]=d((e=>j("remind")),["stop"])),text:"提醒发货"})])),_:1})):30===e.item.status?(n(),v(_,{key:2},[u(C,{class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[3]||(a[3]=d((e=>j("logistics")),["stop"])),text:"查看物流"})])),_:1}),c("   "),u(C,{class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[4]||(a[4]=d((e=>j("receivingMaterials")),["stop"])),text:"已收材料"})])),_:1}),c("   ")],64)):40===e.item.status?(n(),r(C,{key:3,class:"function-btn"},{default:i((()=>[u(U,{btnStyle:w,onClick:a[5]||(a[5]=d((e=>j("produced")),["stop"])),text:"制作完成"})])),_:1})):50===e.item.status?(n(),v(_,{key:4},[],64)):60===e.item.status?(n(),v(_,{key:5},[],64)):b("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-c735af4b"]]),N=t({__name:"OrderListComponent",props:{status:{type:[Number,Array,null,void 0],default:null}},setup(e,{expose:t}){const a=e,s=y(a.status);C((()=>a.status),(e=>s.value=e));const d=y([]),m=y(!1),f=y(!1),b=y(1),g=y(10),A=y(!1),R=y("loadmore"),V=y("flower");let B=y(""),T=y(!1),O=y(!1),z=y(!1),P=y(!1),N={},H=y({});const W=async(e=!1)=>{if(e&&(b.value=1,A.value=!1,f.value=!0,d.value=[]),!A.value||e){m.value=!0,R.value="loading";try{const t={page_no:b.value,page_size:g.value};null!=a.status&&null!=a.status&&(t.status=a.status);const s=await D(t);if(200===s.code||0===s.code){const t=s.data.lists||[];t.length<g.value&&(A.value=!0,R.value="nomore"),e?(d.value=t,e||(R.value="loadmore")):(d.value=[...d.value,...t],R.value=A.value?"loadmore":"nomore"),b.value++}else console.error("获取订单列表失败:",s.msg)}catch(t){e||(R.value="loadmore"),console.error("数据加载失败:",t)}finally{m.value=!1,f.value=!1}}};w((()=>{}));const X=()=>{f.value=!0,W(!0)},Y=()=>{m.value||A.value||W()},Q=async()=>{const{msg:e,data:t,code:a}=await M({id:N.id,order_id:N.order_id,status:90});200===a?(I({title:"订单已取消",icon:"none"}),X()):I({title:e||"操作失败",icon:"none"})},$=async()=>{const{msg:e,data:t,code:a}=await M({id:N.id,order_id:N.order_id,status:40});200===a?(I({title:"已确认收到材料",icon:"none"}),X()):I({title:e||"操作失败",icon:"none"})},J=async()=>{if(!B.value)return void I({title:"请输入物流单号",icon:"none"});const{msg:e,data:t,code:a}=await M({id:N.id,order_id:N.order_id,status:50,finish_order_number:B.value});200===a?(I({title:"订单已完成",icon:"none"}),B.value="",X()):I({title:e||"操作失败",icon:"none"})},Z=()=>{},q=({type:e,item:t})=>{switch(N=t,e){case"cancel":T.value=!0;break;case"pay":(async e=>{if(!e.id)return void I({title:"订单ID不能为空",icon:"none"});const{code:t,msg:a,data:s={}}=await L({order_id:e.order_id});200==t?(H.value=s.lists||{},H.value.id=e.id,F({url:`/pages/xn/my/deposit?id=${e.id}&order_id=${e.order_id}`,success:e=>{e.eventChannel.emit("sendMarginDatas",{marginResultData:H.value})},fail:e=>{console.error("跳转失败",e)}})):I({title:a||"订单详情获取失败",icon:"none"})})(t);break;case"remind":(async e=>{const{msg:t,data:a,code:s}=await U({order_id:e.order_id});I(200===s?{title:"已提醒商家发货",icon:"none"}:{title:t||"操作失败",icon:"none"})})(t);break;case"logistics":F({url:"https://www.baidu.com/s?wd=773394725450239",success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:N})}}),I({title:"查看物流详情",icon:"none"});break;case"receivingMaterials":z.value=!0;break;case"delete":P.value=!0;break;case"produced":O.value=!0;break;case"detail":F({url:"/pages/xn/orders/detail",success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:N})}})}};return h((()=>{W(!0)})),t({setStatus:function(e){s.value=e}}),(e,t)=>{const a=l(o("XnOrdersOrderManagementCard"),K),s=l(o("BaseProductList"),G),m=l(o("CxModal"),E),b=x,g=l(o("u-input"),k);return n(),v(_,null,[u(s,{onOnScrollToLower:Y,onOnRefresh:X,isRefreshing:p(f),loadStatus:p(R),iconType:p(V),enableRefresh:!1,enableLoadMore:!0,class:"order-list"},{scrollContain:i((()=>[(n(!0),v(_,null,S(p(d),((e,t)=>(n(),r(a,{key:e.id||t,item:e,onAction:q},null,8,["item"])))),128))])),_:1},8,["isRefreshing","loadStatus","iconType"]),u(m,{show:p(T),"onUpdate:show":t[0]||(t[0]=e=>j(T)?T.value=e:T=e),content:"确定要取消订单吗？",onConfirm:Q},null,8,["show"]),u(m,{show:p(z),"onUpdate:show":t[1]||(t[1]=e=>j(z)?z.value=e:z=e),content:"确认收材料了吗？",onConfirm:$},null,8,["show"]),u(m,{show:p(O),"onUpdate:show":t[3]||(t[3]=e=>j(O)?O.value=e:O=e),content:"确认完成了吗？",onConfirm:J},{default:i((()=>[u(b,{class:"input-wrap"},{default:i((()=>[u(b,{style:{"font-size":"28rpx",color:"#333","margin-bottom":"10rpx"}},{default:i((()=>[c("请输入物流单号,切勿填错")])),_:1}),u(g,{modelValue:p(B),"onUpdate:modelValue":t[2]||(t[2]=e=>j(B)?B.value=e:B=e),placeholder:"请输入你的物流单号",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"]),u(m,{show:p(P),"onUpdate:show":t[4]||(t[4]=e=>j(P)?P.value=e:P=e),content:"确定要删除订单吗？",onConfirm:Z},null,8,["show"])],64)}}},[["__scopeId","data-v-9d8adc05"]]),H=t({__name:"order-management",setup(t){R((e=>({"25ee2eb1":f})));let s=y("订单管理"),d=y(null),c=y(0);const{proxy:m}=B(),f=m.$safeAreaInfo.top+80+"rpx",v=[{name:"全部",status:null},{name:"待支付",status:10},{name:"待发货",status:20},{name:"待收材料",status:30},{name:"待发成品",status:40},{name:"待接收成品",status:50},{name:"待验收",status:60},{name:"验收成功",status:70},{name:"验收失败",status:80},{name:"已取消",status:90}];let _=y(v.map((e=>({name:e.name}))));const b=a((()=>v[c.value].status));return a((()=>{const e=b.value;return null==e?null:e})),C(b,((e,t)=>{var a;null==(a=d.value)||a.setStatus(t)})),V((e=>{e.tabIndex&&(c.value=Number(e.tabIndex))})),(t,a)=>{const d=l(o("LayoutNavigation"),e),m=l(o("CxTabs"),O),f=x;return n(),r(f,{class:"page-wrap order-management"},{default:i((()=>[u(d,{title:p(s)},null,8,["title"]),u(f,{class:"page-content"},{default:i((()=>[u(m,{tabItems:p(_),scrollable:!0,lineHeight:"5",lineWidth:"56rpx",itemStyle:{padding:"2rpx 25rpx"},activeStyle:{color:"#fff"},lineBg:p("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAICAMAAACMAFxIAAAAzFBMVEUAAAD4KBv/gFf5eVn4Kxz4LB35LB38elf8fVj8fVr7elj4Kx38fFn8elf8fVn4Khz4LR78elf8fVn4LR74Kx34LB74LR74Lh/4MCD4MSH4MiL4NCP5NST5Nyb5OSf5Oij5PCn5Piv5QCz5Qi75RC/5RjD5SDL5SjP6TDX6Tjb6UDj6Ujr6VDv6Vj36WD76WkD6XEH6XkP7YET7Ykb7ZEf7Zkn7aEr7akv7bE37bk77b0/7cVH7c1L8dFP8dlT8d1X8eFb8elf8e1j8fFlwxwMgAAAAFHRSTlMAJiYora2tra2tru7u8fHz8/Pz9A5jUGUAAABISURBVBgZlcFBDoAgDATAbW00QnyP/z9qvPAYawhU/QI7IxDLi4wq3kMkJWGcrtMKyj5rBikpWF1vkJrGA8pR7fO2GUZdUd8fzbgT1C1Y/jMAAAAASUVORK5CYII="),modelValue:p(c),"onUpdate:modelValue":a[0]||(a[0]=e=>j(c)?c.value=e:c=e),class:"order-management-tabs"},null,8,["tabItems","lineBg","modelValue"]),u(f,{class:"orders-list"},{default:i((()=>[(n(),r(T,null,[(n(),r(o(N),{status:p(b),key:`order-${p(b)}`},null,8,["status"]))],1024))])),_:1})])),_:1}),u(f)])),_:1})}}},[["__scopeId","data-v-e9db5379"]]);export{H as default};
