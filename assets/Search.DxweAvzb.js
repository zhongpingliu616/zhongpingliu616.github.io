import{_ as e,r as a,x as l,z as t,y as s,ac as o,o as u,b as r,f as i,j as c,k as n,g as d,F as p,h as f,U as v,t as m,E as _,m as h,ad as b,ab as w,w as g,d as y,v as x,a as C,A as k,u as F,B as j,n as S,l as T,G as V,D as M,C as z}from"./index-E36eYFUz.js";import{_ as B}from"./CxSearch.C2HbS0jD.js";import{_ as L}from"./uni-icons.DKvk8G6K.js";import{_ as U}from"./ProductList.aAvT4MfD.js";import{_ as P}from"./CxModal.B62FgOA2.js";import{d as R}from"./xn.B6pvNNd_.js";import{_ as $}from"./CxComfirmBtn.D_Y-qTM9.js";import{_ as A}from"./ProductCol.CABxG2wB.js";import{u as E}from"./public.3bS5zsGE.js";const N=e({__name:"FilterCriteria",props:{show:{type:Boolean,default:!1}},emits:["update:show","confirm"],setup(e,{emit:g}){const y=g,x=[{label:"综合排序",value:"default"},{label:"最新发布",value:"newest"},{label:"最多点赞",value:"most_liked"},{label:"价格从高到低",value:"price_desc"},{label:"价格从低到高",value:"price_asc"}],C=[{label:"不限时间",value:"unlimited"},{label:"一天内",value:"1day"},{label:"一周内",value:"1week"},{label:"半年内",value:"6months"},{label:"半年之前",value:"before6months"}],k=a("default"),F=a("unlimited"),j=a("unlimited"),S=a(""),T=a(""),V=()=>{y("update:show",!1)},M=()=>{y("confirm",{sort:k.value,time:F.value,price:{type:j.value,min:S.value,max:T.value}}),V()};return(a,g)=>{const y=_,z=l(s("u-icon"),t),B=h,L=b,U=w,P=l(s("CxComfirmBtn"),$),R=l(s("u-popup"),o);return u(),r(R,{show:e.show,mode:"bottom",onClose:V,round:"20rpx"},{default:i((()=>[c(B,{class:"filter-container"},{default:i((()=>[c(B,{class:"header"},{default:i((()=>[c(y,{class:"title"},{default:i((()=>[n("全部筛选")])),_:1}),c(z,{name:"close",color:"#fff",size:"28",onClick:V})])),_:1}),c(U,{"scroll-y":"",class:"filter-content"},{default:i((()=>[c(B,{class:"filter-group"},{default:i((()=>[c(B,{class:"group-title"},{default:i((()=>[n("排序依据")])),_:1}),c(B,{class:"tags-wrapper"},{default:i((()=>[(u(),d(p,null,f(x,((e,a)=>c(B,{key:a,class:v(["filter-tag",{active:k.value===e.value}]),onClick:a=>k.value=e.value},{default:i((()=>[n(m(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),c(B,{class:"filter-group"},{default:i((()=>[c(B,{class:"group-title"},{default:i((()=>[n("发布时间")])),_:1}),c(B,{class:"tags-wrapper"},{default:i((()=>[(u(),d(p,null,f(C,((e,a)=>c(B,{key:a,class:v(["filter-tag",{active:F.value===e.value}]),onClick:a=>F.value=e.value},{default:i((()=>[n(m(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),c(B,{class:"filter-group"},{default:i((()=>[c(B,{class:"group-title"},{default:i((()=>[n("价格区间")])),_:1}),c(B,{class:"price-input-wrapper"},{default:i((()=>[c(B,{class:v(["filter-tag price-tag",{active:"unlimited"===j.value}]),onClick:g[0]||(g[0]=e=>j.value="unlimited")},{default:i((()=>[n(" 不限价格 ")])),_:1},8,["class"]),c(B,{class:"input-box",onClick:g[5]||(g[5]=e=>j.value="custom")},{default:i((()=>[c(L,{type:"number",modelValue:S.value,"onUpdate:modelValue":g[1]||(g[1]=e=>S.value=e),placeholder:"输入最低价","placeholder-class":"placeholder-style",onFocus:g[2]||(g[2]=e=>j.value="custom")},null,8,["modelValue"]),c(y,{class:"divider"},{default:i((()=>[n("—")])),_:1}),c(L,{type:"number",modelValue:T.value,"onUpdate:modelValue":g[3]||(g[3]=e=>T.value=e),placeholder:"输入最高价","placeholder-class":"placeholder-style",onFocus:g[4]||(g[4]=e=>j.value="custom")},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),c(B,{class:"footer-btns"},{default:i((()=>[c(B,{class:"footer-btn-item"},{default:i((()=>[c(P,{text:"取消",btnStyle:{background:"transparent",border:"1px solid #FFE185",borderRadius:"40rpx"},textStyle:{color:"#FFE185"},onClick:V})])),_:1}),c(B,{style:{width:"30rpx"}}),c(B,{class:"footer-btn-item"},{default:i((()=>[c(P,{text:"确定",btnStyle:{width:"100%"},onClick:M})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}},[["__scopeId","data-v-afabfdf5"]]),I=e({__name:"Search",props:{showTabs:{type:Boolean,default:!0}},emits:["close"],setup(e,{expose:o,emit:b}){let w=a("");const $=b;a(null);let I=a(!1);a(10);let O=a(!1);const q=a([]),D=a(!1),G=a(0),H=a({});a(3);const J=a([]),K=a(!1),Q=a(!1),W=a(1),X=a(10),Y=a(!1),Z=a("loadmore"),ee=a("flower"),ae=e=>{H.value=e,console.log("筛选条件：",H.value),te(!0)},le=({item:e})=>{ue(e)},te=async(e=!1)=>{if((!K.value||e)&&(!Q.value||e)&&(!Y.value||e)){e?(W.value=1,Y.value=!1,Q.value=!0,J.value=[],Z.value="loading"):(K.value=!0,Z.value="loading");try{await new Promise((e=>setTimeout(e,500)));const a=Array.from({length:X.value}).map(((e,a)=>{const l=(W.value-1)*X.value+a+1,t=0===G.value;return{id:l,image:t?"https://cdn.uviewui.com/uview/album/1.jpg":"https://cdn.uviewui.com/uview/album/2.jpg",artist_name:t?`数字艺术家${l}`:`非遗传承人${l}`,title:t?`NFT数字藏品 #${l}`:`苏绣实物精品 #${l}`,price:(1e3*Math.random()).toFixed(2),tag:t?"NFT藏品":"实物藏品",original_price:(2e3*Math.random()+1e3).toFixed(2),view_count:Math.floor(1e4*Math.random()),is_liked:Math.random()>.5}}));"price_asc"===H.value.sort?a.sort(((e,a)=>parseFloat(e.price)-parseFloat(a.price))):"price_desc"===H.value.sort?a.sort(((e,a)=>parseFloat(a.price)-parseFloat(e.price))):"most_liked"===H.value.sort&&a.sort(((e,a)=>a.view_count-e.view_count));const l=a.map((e=>({...e,image:e.image||e.cover||"",artist:e.artist_name||e.author||"未知绣娘",title:e.title||e.name||"",description:e.price||"0",originalPrice:e.original_price||"0",price:e.view_count||"0",favoriteType:e.is_liked?"heart-fill":"heart"})));l.length<X.value?(Y.value=!0,Z.value="nomore"):Z.value="loadmore",e?(J.value=l,V()):J.value=[...J.value,...l],W.value++}catch(a){Z.value="loadmore",console.error("数据加载失败:",a),M({title:"加载失败",icon:"none"})}finally{K.value=!1,Q.value=!1}}},se=()=>{Q.value||te(!0)},oe=()=>{K.value||Y.value||te()},ue=e=>{z({url:`/pages-xn/collection-detail/index?id=${e.id}`})},re=async()=>{try{const e=await R({type:2});200===e.code?(q.value=[],O.value=!1,M({title:"搜索历史已清空",icon:"success"})):M({title:e.msg||"清空失败",icon:"none"})}catch(e){console.error("清空历史失败",e),M({title:"请求异常",icon:"none"})}},ie=()=>{O.value=!0},ce=()=>{$("close")},ne=E((e=>{(e=>{w.value||e?te(!0).then((()=>{})):M({title:"请输入搜索内容",icon:"none"})})(e)}),1800);return o({setTab:e=>{G.value!==e&&(G.value=e)}}),g(w,(e=>{e&&console.log("搜索",e)})),g(G,(()=>{te(!0)})),y((()=>{te(),x((()=>{I.value=!0}))})),(a,o)=>{const b=C("up-icon"),g=h,y=C("up-col"),x=l(s("CxSearch"),B),V=C("up-row"),M=l(s("uni-icons"),L),z=_,R=l(s("u-icon"),t),$=l(s("u-tag"),k),E=l(s("BaseProductList"),U),I=l(s("CxModal"),P);return u(),d(p,null,[c(g,{class:"search-wrap search"},{default:i((()=>[c(g,{class:"search-bar-wrap"},{default:i((()=>[c(V,{customStyle:"margin-bottom: 10px"},{default:i((()=>[c(y,{span:"1"},{default:i((()=>[c(g,{class:"bell-pic"},{default:i((()=>[c(b,{name:"arrow-left",color:"#fff",size:"40rpx",onClick:ce})])),_:1})])),_:1}),c(y,{span:"11"},{default:i((()=>[c(g,{class:"search-bar"},{default:i((()=>[c(x,{modelValue:F(w),"onUpdate:modelValue":o[0]||(o[0]=e=>j(w)?w.value=e:w=e),placeholder:"输入搜索内容",showAction:"","action-text":"搜索",onSearch:F(ne),onCustom:F(ne),actionStyle:{backgroundColor:"#074685"}},null,8,["modelValue","onSearch","onCustom"])])),_:1})])),_:1})])),_:1}),c(g,{class:"tabs-filter-row",style:S({justifyContent:e.showTabs?"space-between":"flex-end"})},{default:i((()=>[e.showTabs?(u(),r(g,{key:0,class:"tabs-wrapper"},{default:i((()=>[c(g,{class:v(["tab-item",{active:0===F(G)}]),onClick:o[1]||(o[1]=e=>G.value=0)},{default:i((()=>[n(" NFT藏品 "),0===F(G)?(u(),r(g,{key:0,class:"active-line"})):T("",!0)])),_:1},8,["class"]),c(g,{class:v(["tab-item",{active:1===F(G)}]),onClick:o[2]||(o[2]=e=>G.value=1)},{default:i((()=>[n(" 实物藏品 "),1===F(G)?(u(),r(g,{key:0,class:"active-line"})):T("",!0)])),_:1},8,["class"])])),_:1})):T("",!0),c(g,{class:"filter-icon",onClick:o[3]||(o[3]=e=>D.value=!0)},{default:i((()=>[c(M,{"custom-prefix":"iconfont",type:"icon-shaixuan",size:"30rpx",color:"#ffffff"})])),_:1})])),_:1},8,["style"])])),_:1}),F(q).length&&!F(w)?(u(),r(g,{key:0,class:"history-search-container"},{default:i((()=>[F(w)?T("",!0):(u(),d(p,{key:0},[c(g,{class:"header"},{default:i((()=>[c(z,{class:"title"},{default:i((()=>[n("历史搜索")])),_:1}),c(R,{name:"trash",size:"20",color:"rgba(225, 210, 211, 1)",onClick:ie})])),_:1}),c(g,{class:"tags-container"},{default:i((()=>[(u(!0),d(p,null,f(F(q),((e,a)=>(u(),r($,{key:a,text:e,shape:"circle",borderColor:"rgba(245, 234, 201, .6)",color:"#F5EAC9",plain:"",style:{margin:"8rpx",padding:"1rpx 4rpx"},onClick:a=>{return l=e,void(w.value=l);var l}},null,8,["text","onClick"])))),128))])),_:1})],64))])),_:1})):T("",!0),c(g,{class:"search-result"},{default:i((()=>[c(z,{class:"search-result-text"},{default:i((()=>[n("共个"+m(F(J).length)+"搜索结果",1)])),_:1}),c(E,{onOnScrollToLower:oe,onOnRefresh:se,isRefreshing:F(Q),loadStatus:F(Z),iconType:F(ee),enableRefresh:!1,enableLoadMore:!0},{scrollContain:i((()=>[c(A,{productList:F(J),colNum:2,onClick:le},null,8,["productList"])])),_:1},8,["isRefreshing","loadStatus","iconType"])])),_:1})])),_:1}),c(N,{show:F(D),"onUpdate:show":o[4]||(o[4]=e=>j(D)?D.value=e:null),onConfirm:ae},null,8,["show"]),c(I,{show:F(O),"onUpdate:show":o[5]||(o[5]=e=>j(O)?O.value=e:O=e),content:"确定要清空历史搜索吗？",onConfirm:re},null,8,["show"])],64)}}},[["__scopeId","data-v-72e4ecdb"]]);export{I as _,N as a};
