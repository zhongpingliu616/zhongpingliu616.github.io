import{_ as e,K as o,r as s,au as a,x as t,y as l,b as n,f as r,J as c,Z as d,aF as i,m as p,z as u,o as m,j as f,u as x,l as h,n as w,k as y,t as g,aR as _,D as v,aq as z,aE as P,p as V,E as k}from"./index-E36eYFUz.js";import{_ as b}from"./Navigation.fXnM5b3z.js";import{_ as C}from"./CxComfirmBtn.D_Y-qTM9.js";import{_ as j,a as F}from"./emiyanzhengma.C1RAKEWA.js";import{_ as I}from"./mima.CnEZst9Z.js";const U=e({__name:"reset-psd",setup(e){o((e=>({"0c4b1dd8":$})));const{proxy:U}=c(),$=U.$safeAreaInfo.top+80+"rpx";let A=s("重置密码"),B=s(!1);const E=a({phone:"",code:"",password:"",confirmPassword:""}),K=a({phone:"",code:"",password:"",confirmPassword:""}),N=e=>{K[e]="",B.value=!1},Z=async()=>{if((()=>{let e=!0;E.phone?/^1[3-9]\d{9}$/.test(E.phone)||(K.phone="手机号格式不正确",e=!1):(K.phone="手机号不能为空",e=!1),E.code?6!==E.code.length&&(K.code="验证码应为6位",e=!1):(K.code="验证码不能为空",e=!1);const o=E.password;return o?o.length<6||o.length>20?(K.password="密码长度6-20位",e=!1):/^[A-Za-z]/.test(o)||(K.password="密码必须字母开头",e=!1):(K.password="密码不能为空",e=!1),E.confirmPassword?E.confirmPassword!==o&&(K.confirmPassword="两次输入的密码不一致",e=!1):(K.confirmPassword="请再次输入密码",e=!1),e})()){B.value=!0;try{const e=await _({phone:E.phone,password:E.password,sms_code:E.code,confirm_password:E.confirmPassword});200===e.code?(v({title:"修改成功！",icon:"success"}),setTimeout((()=>{z()}),1500)):v({title:e.msg||"修改失败",icon:"none"})}catch(e){console.error("重置密码失败",e),v({title:e.msg||"请求异常",icon:"none"})}finally{B.value=!1}}},q=s(!1),D=s(!1),J=s(!1),L=s(60),R=async()=>{if(!J.value)if(E.phone)if(/^1[3-9]\d{9}$/.test(E.phone))try{const e=await P({phone:E.phone,type:2});if(200===e.code){v({title:"验证码已发送",icon:"success"}),J.value=!0,E.code=e.data.sms_code;const o=setInterval((()=>{L.value--,L.value<=0&&(clearInterval(o),J.value=!1,L.value=60)}),1e3)}else v({title:e.msg||"发送失败",icon:"none"})}catch(e){console.error("发送验证码失败",e),v({title:e.msg||"发送失败",icon:"none"})}else K.phone="请输入正确的手机号";else K.phone="请输入手机号"},T=()=>{q.value=!q.value},W=()=>{D.value=!D.value};return(e,o)=>{const s=t(l("LayoutNavigation"),b),a=V,c=t(l("u-input"),d),_=t(l("u-text"),i),v=p,z=k,P=t(l("u-icon"),u),U=t(l("CxComfirmBtn"),C);return m(),n(v,{class:"page-wrap index"},{default:r((()=>[f(s,{title:x(A)},null,8,["title"]),f(v,{class:"page-content"},{default:r((()=>[f(v,{class:"container"},{default:r((()=>[f(v,{class:"input-item"},{default:r((()=>[f(a,{class:"input-icon",src:j,mode:"aspectFit"}),f(c,{modelValue:x(E).phone,"onUpdate:modelValue":[o[0]||(o[0]=e=>x(E).phone=e),o[1]||(o[1]=e=>N("phone"))],placeholder:"请输入您的手机号码",type:"number",border:"none",maxlength:"11","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),x(K).phone?(m(),n(_,{key:0,class:"error-text",text:x(K).phone,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):h("",!0)])),_:1}),f(v,{class:"input-item"},{default:r((()=>[f(a,{class:"input-icon",src:F,mode:"aspectFit"}),f(c,{modelValue:x(E).code,"onUpdate:modelValue":[o[2]||(o[2]=e=>x(E).code=e),o[3]||(o[3]=e=>N("code"))],placeholder:"请输入验证码",type:"text",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),x(K).code?h("",!0):(m(),n(z,{key:0,onClick:R,class:"verify-btn",style:w({color:x(J)?"#ccc":"#ff4d4d",fontWeight:"normal"})},{default:r((()=>[y(g(x(J)?`${x(L)}s后重试`:"获取验证码"),1)])),_:1},8,["style"])),x(K).code?(m(),n(_,{key:1,class:"error-text",text:x(K).code,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):h("",!0)])),_:1}),f(v,{class:"input-item"},{default:r((()=>[f(a,{class:"input-icon",src:I,mode:"aspectFit"}),f(c,{modelValue:x(E).password,"onUpdate:modelValue":[o[4]||(o[4]=e=>x(E).password=e),o[5]||(o[5]=e=>N("password"))],placeholder:"字母开头,必须包含特殊字符6-20位",type:x(q)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),f(P,{name:x(q)?"eye":"",size:"36",color:"#999",onClick:T},null,8,["name"]),x(K).password?(m(),n(_,{key:0,class:"error-text",text:x(K).password,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):h("",!0)])),_:1}),f(v,{class:"input-item"},{default:r((()=>[f(a,{class:"input-icon",src:I,mode:"aspectFit"}),f(c,{modelValue:x(E).confirmPassword,"onUpdate:modelValue":[o[6]||(o[6]=e=>x(E).confirmPassword=e),o[7]||(o[7]=e=>N("confirmPassword"))],placeholder:"请再次输入密码",type:x(D)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),f(P,{name:x(D)?"eye":"",size:"36",color:"#999",onClick:W},null,8,["name"]),x(K).confirmPassword?(m(),n(_,{key:0,class:"error-text",text:x(K).confirmPassword,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):h("",!0)])),_:1})])),_:1}),f(v,{class:"regist-btn-wrap"},{default:r((()=>[f(U,{text:"确认修改",loading:x(B),onClick:Z},null,8,["loading"])])),_:1})])),_:1}),f(v)])),_:1})}}},[["__scopeId","data-v-53ec5761"]]);export{U as default};
