import{_ as a,r as e,af as t,c as l,a2 as n,C as s,D as r,g as i,j as o,f as u,u as c,H as d,F as m,P as p,J as g,m as f,a7 as v,ar as _,aW as k,$ as x,o as h,k as b,t as y,au as S,av as C,aX as w,ae as V,p as j,A as W}from"./index-CFeN5XM9.js";import{_ as z}from"./Navigation.B6I6j3Nc.js";import{_ as L}from"./CxComfirmBtn.BA1OBJ6W.js";import{_ as U}from"./CxModal.DjfFHvB7.js";const D=a({__name:"profile-edit",setup(a){const{proxy:D}=p();let F=D.getOpenerEventChannel(),M=e(null),B=e(!1),I={data:{url:""},code:-999,msg:""},N=t({avatar:"",reg_ip:"",nickname:"",signature:""}),P=e(!1),T=e("");const A=()=>{S({count:1,success:async a=>{I=await C(a.tempFilePaths[0]);const{code:e=9999,data:t={},msg:l=""}=I;200===e?(g({title:"上传成功，等待审核",icon:"success"}),N.avatar=t.url):g({title:l||"上传失败，请重试",icon:"none"})}})},E=async()=>{try{const a=await w({avatar:I.data.url||"",nick_name:T.value||"",signature:N.signature||""}),{code:e=9999,data:t,msg:l}=a;200===e?(g({title:"已提交",icon:"success"}),N.nickname=T.value||N.nickname,N.signature=N.signature||"",setTimeout((()=>{V({delta:1})}),1500)):g({title:l||"更新失败，请重试",icon:"none"})}catch(a){g({title:"更新失败，请重试",icon:"none"})}},H=l((()=>{if(!B.value||!M.value)return!1;const a=!!T.value&&T.value!==M.value.nickname;return N.avatar!==M.value.avatar||a||N.signature!==M.value.signature})),J=()=>{T.value=N.nickname,P.value=!0},O=()=>{T.value.trim()?N.nickname=T.value:g({title:"昵称不能为空",icon:"none"})},R=()=>{console.log("查看二维码")};return n((()=>{M.value={avatar:N.avatar,nickname:N.nickname,signature:N.signature},B.value=!0,F.on("sendUserData",(a=>{N.reg_ip=a.reg_ip,N.avatar=a.avatar,N.nickname=a.nick_name,N.signature=a.signature,M.value={avatar:N.avatar,nickname:N.nickname,signature:N.signature},B.value=!0}))})),(a,e)=>{const t=s(r("LayoutNavigation"),z),l=j,n=f,p=s(r("u-cell"),v),g=s(r("u-cell-group"),_),S=W,C=s(r("u-textarea"),k),w=s(r("CxComfirmBtn"),L),V=s(r("u-input"),x),D=s(r("CxModal"),U);return h(),i(m,null,[o(n,{class:"page-wrap profile-edit"},{default:u((()=>[o(t,{title:"编辑资料"}),o(n,{class:"page-content"},{default:u((()=>[o(n,{class:"form-card"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"头像",isLink:!0,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(n,{class:"avatar-wrap"},{default:u((()=>[o(l,{class:"avatar",src:c(N).avatar,mode:"aspectFill",onClick:A},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"ID",border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(S,{class:"id-text"},{default:u((()=>[b(y(c(N).reg_ip),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"昵称",isLink:!0,onClick:J,border:!0,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(S,{class:"nickname-text"},{default:u((()=>[b(y(c(N).nickname),1)])),_:1})])),_:1}),o(p,{title:"我的二维码",isLink:!0,onClick:R,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"})])),_:1})])),_:1}),o(n,{class:"form-card mt-20 signature-card"},{default:u((()=>[o(n,{class:"signature-title"},{default:u((()=>[b("个性签名")])),_:1}),o(C,{modelValue:c(N).signature,"onUpdate:modelValue":e[0]||(e[0]=a=>c(N).signature=a),placeholder:"这里是个性签名...",border:"none",maxlength:100,height:"200",customStyle:"background: transparent; padding: 0;"},null,8,["modelValue"])])),_:1}),o(n,{class:"mt-20 save-profile"},{default:u((()=>[o(w,{text:"保存",disabled:!c(H),onClick:E},null,8,["disabled"])])),_:1})])),_:1})])),_:1}),o(D,{show:c(P),"onUpdate:show":e[2]||(e[2]=a=>d(P)?P.value=a:P=a),title:"修改昵称",onConfirm:O},{default:u((()=>[o(n,{class:"input-wrap"},{default:u((()=>[o(V,{modelValue:c(T),"onUpdate:modelValue":e[1]||(e[1]=a=>d(T)?T.value=a:T=a),placeholder:"请输入昵称",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-dd9290b2"]]);export{D as default};
