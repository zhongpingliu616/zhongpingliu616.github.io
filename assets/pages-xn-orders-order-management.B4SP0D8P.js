import{_ as e}from"./Navigation.fXnM5b3z.js";import{_ as t,c as a,a as s,x as l,y as n,o,b as r,f as i,j as u,a1 as d,k as c,t as m,n as f,u as p,g as v,F as _,l as b,E as g,m as x,p as A,r as y,w as C,ay as k,d as h,h as w,B as j,D as S,C as D,K as F,ai as M,J as I,Q as B}from"./index-E36eYFUz.js";import{_ as L}from"./CxTabs.BRUHryh_.js";import{_ as U}from"./CxTag.DU_-stGW.js";import{_ as R}from"./CxComfirmBtn.D_Y-qTM9.js";import{_ as T}from"./ProductList.aAvT4MfD.js";import{_ as V}from"./CxModal.B62FgOA2.js";import{o as O,e as P,c as z}from"./xn.B6pvNNd_.js";const E=t({__name:"OrderManagementCard",props:{item:{type:Object,default:()=>({})}},emits:["action"],setup(e,{emit:t}){const y=t,C=e,k={padding:"0rpx 34rpx"},h={10:{text:"待支付",color:"#FF4D4F"},15:{text:"待支付",color:"#FF4D4F"},20:{text:"待发货",color:"#FA8C16"},30:{text:"待接收材料",color:"#1890FF"},40:{text:"待发成品",color:"#FA541C"},50:{text:"待接收成品",color:"#13C2C2"},60:{text:"待验收",color:"#722ED1"},70:{text:"验收成功",color:"#52C41A"},80:{text:"验收失败",color:"#A8071A"},90:{text:"取消订单",color:"#8C8C8C"}},w=a((()=>{var e;return(null==(e=h[C.item.status])?void 0:e.text)||"未知状态"})),j=a((()=>{var e;return(null==(e=h[C.item.status])?void 0:e.color)||"#333"})),S=e=>{y("action",{type:e,item:C.item})},D=()=>{y("action",{type:"detail",item:C.item})};return(t,a)=>{const y=g,C=x,h=s("up-col"),F=s("up-row"),M=A,I=l(n("CxTag"),U),B=l(n("CxComfirmBtn"),R);return o(),r(C,{key:e.item.id+Math.random(),class:"order-card-item"},{default:i((()=>[u(C,{class:"order-status",onClick:d(D,["stop"])},{default:i((()=>[u(F,{justify:"space-between",customStyle:"margin-bottom: 1rpx"},{default:i((()=>[u(h,{span:"9"},{default:i((()=>[u(C,{class:"order-id"},{default:i((()=>[u(y,{class:"order-id-text"},{default:i((()=>[c("订单号: "+m(e.item.order_id)+" "+m(e.item.status),1)])),_:1})])),_:1})])),_:1}),u(h,{span:"3"},{default:i((()=>[u(C,{class:"right-wrap"},{default:i((()=>[u(C,{class:"status-btn"},{default:i((()=>[u(y,{style:f({fontSize:"24rpx",color:p(j)})},{default:i((()=>[c(m(p(w)),1)])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"card-header"},{default:i((()=>[u(M,{src:e.item.image,class:"card-image",mode:"aspectFill"},null,8,["src"]),u(C,{class:"card-content"},{default:i((()=>[u(C,{class:"card-title"},{default:i((()=>[c(m(e.item.name),1)])),_:1}),u(C,{class:"tags"},{default:i((()=>[u(I,{text:e.item.period||"工期360天",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"]),c("  "),u(I,{text:e.item.difficulty||"难度低",bgGradient:["rgba(248,163,29,0.1)","rgba(248,163,29,0.1)"]},null,8,["text","bgGradient"])])),_:1}),u(C,{class:"bottom-row"},{default:i((()=>[u(y,{class:"cur-order-price"},{default:i((()=>[c(" ￥"+m(e.item.reward_amount||""),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"status-function-bts"},{default:i((()=>[10===e.item.status||15===e.item.status?(o(),v(_,{key:0},[u(C,{class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[0]||(a[0]=e=>S("cancel")),text:"取消订单"})])),_:1}),c("   "),u(C,{class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[1]||(a[1]=e=>S("pay")),text:"去支付"})])),_:1})],64)):20===e.item.status?(o(),r(C,{key:1,class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[2]||(a[2]=e=>S("remind")),text:"提醒发货"})])),_:1})):30===e.item.status?(o(),v(_,{key:2},[u(C,{class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[3]||(a[3]=e=>S("logistics")),text:"查看物流"})])),_:1}),c("   "),u(C,{class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[4]||(a[4]=e=>S("receivingMaterials")),text:"已收材料"})])),_:1}),c("   ")],64)):40===e.item.status?(o(),r(C,{key:3,class:"function-btn"},{default:i((()=>[u(B,{btnStyle:k,onClick:a[5]||(a[5]=e=>S("produced")),text:"提交成品"})])),_:1})):50===e.item.status?(o(),v(_,{key:4},[],64)):60===e.item.status?(o(),v(_,{key:5},[],64)):b("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-25228e81"]]),G=t({__name:"OrderListComponent",props:{status:{type:[Number,Array,null,void 0],default:null}},setup(e,{expose:t}){const a=e,s=y(a.status);C((()=>a.status),(e=>s.value=e));const d=y([]),c=y(!1),m=y(!1),f=y(1),b=y(10),g=y(!1),x=y("loadmore"),A=y("flower");y("");let F=y(!1),M=y(!1),I=y(!1),B=y(!1),L={};y({});const U=async(e=!1)=>{if(e&&(f.value=1,g.value=!1,m.value=!0,d.value=[]),!g.value||e){c.value=!0,x.value="loading";try{const t={page_no:f.value,page_size:b.value};null!=a.status&&null!=a.status&&(t.status=a.status);const s=await O(t);if(200===s.code||0===s.code){const t=s.data.lists||[];t.length<b.value&&(g.value=!0,x.value="nomore"),e?(d.value=t,e||(x.value="loadmore")):(d.value=[...d.value,...t],x.value=g.value?"loadmore":"nomore"),f.value++}else console.error("获取订单列表失败:",s.msg)}catch(t){e||(x.value="loadmore"),console.error("数据加载失败:",t)}finally{c.value=!1,m.value=!1}}};k((()=>{}));const R=()=>{m.value=!0,U(!0)},G=()=>{c.value||g.value||U()},K=async()=>{const{msg:e,data:t,code:a}=await P({id:L.id,order_id:L.order_id,status:90});200===a?(S({title:"订单已取消",icon:"none"}),R()):S({title:e||"操作失败",icon:"none"})},N=async()=>{const{msg:e,data:t,code:a}=await P({id:L.id,order_id:L.order_id,status:40});200===a?(S({title:"已确认收到材料",icon:"none"}),R()):S({title:e||"操作失败",icon:"none"})},H=async()=>{D({url:`/pages-xn/orders/submit-product?id=${L.id}&order_id=${L.order_id}`,success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:L})},fail:e=>{console.error("跳转失败",e)}})},W=()=>{},Y=({type:e,item:t})=>{switch(L=t,e){case"cancel":F.value=!0;break;case"pay":(async e=>{e.id?D({url:`/pages-xn/my/deposit?id=${e.id}&order_id=${e.order_id}`,success:t=>{t.eventChannel.emit("sendMarginDatas",{marginResultData:e})},fail:e=>{console.error("跳转失败",e)}}):S({title:"订单ID不能为空",icon:"none"})})(t);break;case"remind":(async e=>{const{msg:t,data:a,code:s}=await z({order_id:e.order_id});S(200===s?{title:"已提醒商家发货",icon:"none"}:{title:t||"操作失败",icon:"none"})})(t);break;case"logistics":S({title:"查看物流详情",icon:"none"});break;case"receivingMaterials":I.value=!0;break;case"delete":B.value=!0;break;case"produced":M.value=!0;break;case"detail":D({url:"/pages-xn/orders/detail",success:e=>{e.eventChannel.emit("sendOrderDatas",{orderInfo:L})}})}};return h((()=>{U(!0)})),t({setStatus:function(e){s.value=e}}),(e,t)=>{const a=l(n("XnOrdersOrderManagementCard"),E),s=l(n("BaseProductList"),T),c=l(n("CxModal"),V);return o(),v(_,null,[u(s,{onOnScrollToLower:G,onOnRefresh:R,isRefreshing:p(m),loadStatus:p(x),iconType:p(A),enableRefresh:!0,enableLoadMore:!0,class:"order-list"},{scrollContain:i((()=>[(o(!0),v(_,null,w(p(d),((e,t)=>(o(),r(a,{key:e.id||t,item:e,onAction:Y},null,8,["item"])))),128))])),_:1},8,["isRefreshing","loadStatus","iconType"]),u(c,{show:p(F),"onUpdate:show":t[0]||(t[0]=e=>j(F)?F.value=e:F=e),content:"确定要取消订单吗？",onConfirm:K},null,8,["show"]),u(c,{show:p(I),"onUpdate:show":t[1]||(t[1]=e=>j(I)?I.value=e:I=e),content:"确认收材料了吗？",onConfirm:N},null,8,["show"]),u(c,{show:p(M),"onUpdate:show":t[2]||(t[2]=e=>j(M)?M.value=e:M=e),content:"确认完成了吗？",onConfirm:H},null,8,["show"]),u(c,{show:p(B),"onUpdate:show":t[3]||(t[3]=e=>j(B)?B.value=e:B=e),content:"确定要删除订单吗？",onConfirm:W},null,8,["show"])],64)}}},[["__scopeId","data-v-8cb6e9f7"]]),K=t({__name:"order-management",setup(t){F((e=>({b63f7d0c:f})));let s=y("订单管理"),d=y(null),c=y(0);const{proxy:m}=I(),f=m.$safeAreaInfo.top+80+"rpx",v=[{name:"全部",status:null},{name:"待支付",status:10},{name:"待发货",status:20},{name:"待收材料",status:30},{name:"待发成品",status:40},{name:"待接收成品",status:50},{name:"待验收",status:60},{name:"验收成功",status:70},{name:"验收失败",status:80},{name:"已取消",status:90}];let _=y(v.map((e=>({name:e.name}))));const b=a((()=>v[c.value].status));return a((()=>{const e=b.value;return null==e?null:e})),C(b,((e,t)=>{var a;null==(a=d.value)||a.setStatus(t)})),M((e=>{e.tabIndex&&(c.value=Number(e.tabIndex))})),(t,a)=>{const d=l(n("LayoutNavigation"),e),m=l(n("CxTabs"),L),f=x;return o(),r(f,{class:"page-wrap order-management"},{default:i((()=>[u(d,{title:p(s)},null,8,["title"]),u(f,{class:"page-content"},{default:i((()=>[u(m,{tabItems:p(_),scrollable:!0,lineHeight:"5",lineWidth:"56rpx",itemStyle:{padding:"2rpx 25rpx"},activeStyle:{color:"#fff"},lineBg:p("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAICAMAAACMAFxIAAAAzFBMVEUAAAD4KBv/gFf5eVn4Kxz4LB35LB38elf8fVj8fVr7elj4Kx38fFn8elf8fVn4Khz4LR78elf8fVn4LR74Kx34LB74LR74Lh/4MCD4MSH4MiL4NCP5NST5Nyb5OSf5Oij5PCn5Piv5QCz5Qi75RC/5RjD5SDL5SjP6TDX6Tjb6UDj6Ujr6VDv6Vj36WD76WkD6XEH6XkP7YET7Ykb7ZEf7Zkn7aEr7akv7bE37bk77b0/7cVH7c1L8dFP8dlT8d1X8eFb8elf8e1j8fFlwxwMgAAAAFHRSTlMAJiYora2tra2tru7u8fHz8/Pz9A5jUGUAAABISURBVBgZlcFBDoAgDATAbW00QnyP/z9qvPAYawhU/QI7IxDLi4wq3kMkJWGcrtMKyj5rBikpWF1vkJrGA8pR7fO2GUZdUd8fzbgT1C1Y/jMAAAAASUVORK5CYII="),modelValue:p(c),"onUpdate:modelValue":a[0]||(a[0]=e=>j(c)?c.value=e:c=e),class:"order-management-tabs"},null,8,["tabItems","lineBg","modelValue"]),u(f,{class:"orders-list"},{default:i((()=>[(o(),r(B,null,[(o(),r(n(G),{status:p(b),key:`order-${p(b)}`},null,8,["status"]))],1024))])),_:1})])),_:1}),u(f)])),_:1})}}},[["__scopeId","data-v-c07fd34d"]]);export{K as default};
