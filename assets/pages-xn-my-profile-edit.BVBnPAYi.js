import{_ as a,r as e,au as t,c as l,ai as n,x as s,y as r,g as i,j as o,f as u,u as c,B as d,F as m,J as p,D as g,m as f,W as v,X as _,Z as k,aN as x,o as h,k as y,t as b,a4 as S,a5 as C,aO as V,aq as w,p as j,E as U}from"./index-E36eYFUz.js";import{_ as W}from"./Navigation.fXnM5b3z.js";import{_ as z}from"./CxComfirmBtn.D_Y-qTM9.js";import{_ as L}from"./CxModal.B62FgOA2.js";const B=a({__name:"profile-edit",setup(a){const{proxy:B}=p();let D=B.getOpenerEventChannel(),F=e(null),N=e(!1),E={data:{url:""},code:-999,msg:""},I=t({avatar:"",reg_ip:"",nickname:"",signature:""}),M=e(!1),O=e("");const q=()=>{S({count:1,success:async a=>{E=await C(a.tempFilePaths[0]);const{code:e=9999,data:t={},msg:l=""}=E;200===e?(g({title:"上传成功，等待审核",icon:"success"}),I.avatar=t.url):g({title:l||"上传失败，请重试",icon:"none"})}})},A=async()=>{try{const a=await V({avatar:I.avatar||"",nick_name:I.nickname||"",signature:I.signature||""}),{code:e=9999,data:t,msg:l}=a;200===e?(g({title:"已提交",icon:"success"}),I.nickname=O.value||I.nickname,I.signature=I.signature||"",setTimeout((()=>{w({delta:1})}),1500)):g({title:l||"更新失败，请重试",icon:"none"})}catch(a){g({title:"更新失败，请重试",icon:"none"})}},J=l((()=>!(!N.value||!F.value)&&(I.avatar!==F.value.avatar||I.nickname!==F.value.nickname||I.signature!==F.value.signature))),P=()=>{O.value.trim()?I.nickname=O.value:g({title:"昵称不能为空",icon:"none"})},R=()=>{console.log("查看二维码")};return n((()=>{F.value={avatar:I.avatar,nickname:I.nickname,signature:I.signature},N.value=!0,D.on("sendUserData",(a=>{I.reg_ip=a.reg_ip,I.avatar=a.avatar,I.nickname=a.nick_name,I.signature=a.signature,F.value={avatar:I.avatar,nickname:I.nickname,signature:I.signature},N.value=!0}))})),(a,e)=>{const t=s(r("LayoutNavigation"),W),l=j,n=f,p=s(r("u-cell"),v),g=s(r("u-cell-group"),_),S=U,C=s(r("u-input"),k),V=s(r("u-textarea"),x),w=s(r("CxComfirmBtn"),z),B=s(r("CxModal"),L);return h(),i(m,null,[o(n,{class:"page-wrap profile-edit"},{default:u((()=>[o(t,{title:"编辑资料"}),o(n,{class:"page-content"},{default:u((()=>[o(n,{class:"form-card"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"头像",isLink:!0,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(n,{class:"avatar-wrap"},{default:u((()=>[o(l,{class:"avatar",src:c(I).avatar,mode:"aspectFill",onClick:q},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"ID",border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(S,{class:"id-text"},{default:u((()=>[y(b(c(I).reg_ip),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(n,{class:"form-card mt-20"},{default:u((()=>[o(g,{border:!1},{default:u((()=>[o(p,{title:"昵称",isLink:!0,border:!0,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"},{value:u((()=>[o(C,{modelValue:c(I).nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>c(I).nickname=a),placeholder:"请输入昵称","input-align":"right",border:"none",class:"nickname-text"},null,8,["modelValue"])])),_:1}),o(p,{title:"我的二维码",isLink:!0,onClick:R,border:!1,titleStyle:{fontSize:"28rpx",color:"#333",fontWeight:"500"},customStyle:"padding: 30rpx 0;"})])),_:1})])),_:1}),o(n,{class:"form-card mt-20 signature-card"},{default:u((()=>[o(n,{class:"signature-title"},{default:u((()=>[y("个性签名")])),_:1}),o(V,{modelValue:c(I).signature,"onUpdate:modelValue":e[1]||(e[1]=a=>c(I).signature=a),placeholder:"这里是个性签名...",border:"none",maxlength:100,height:"200",customStyle:"background: transparent; padding: 0;"},null,8,["modelValue"])])),_:1}),o(n,{class:"mt-20 save-profile"},{default:u((()=>[o(w,{text:"保存",disabled:!c(J),onClick:A},null,8,["disabled"])])),_:1})])),_:1})])),_:1}),o(B,{show:c(M),"onUpdate:show":e[3]||(e[3]=a=>d(M)?M.value=a:M=a),title:"修改昵称",onConfirm:P},{default:u((()=>[o(n,{class:"input-wrap"},{default:u((()=>[o(C,{modelValue:c(O),"onUpdate:modelValue":e[2]||(e[2]=a=>d(O)?O.value=a:O=a),placeholder:"请输入昵称",border:"surround",clearable:"",customStyle:{height:"52rpx",borderRadius:"10rpx"}},null,8,["modelValue"])])),_:1})])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-13e40c2c"]]);export{B as default};
