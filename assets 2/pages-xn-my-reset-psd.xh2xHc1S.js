import{_ as e,r as o,ad as s,C as a,D as t,b as l,f as n,Y as r,at as c,m as d,E as i,o as p,j as u,u as m,l as f,n as h,k as x,t as w,aN as y,J as g,ac as v,av as _,p as z,A as P}from"./index-Cklw5-2D.js";import{_ as V}from"./Navigation.DJK0J8h_.js";import{_ as k}from"./CxComfirmBtn.C_6MRR7B.js";import{_ as C,a as b}from"./emiyanzhengma.C1RAKEWA.js";import{_ as j}from"./mima.CnEZst9Z.js";const F=e({__name:"reset-psd",setup(e){let F=o("重置密码"),U=o(!1);const I=s({phone:"",code:"",password:"",confirmPassword:""}),N=s({phone:"",code:"",password:"",confirmPassword:""}),$=e=>{N[e]="",U.value=!1},A=async()=>{if((()=>{let e=!0;I.phone?/^1[3-9]\d{9}$/.test(I.phone)||(N.phone="手机号格式不正确",e=!1):(N.phone="手机号不能为空",e=!1),I.code?6!==I.code.length&&(N.code="验证码应为6位",e=!1):(N.code="验证码不能为空",e=!1);const o=I.password;return o?o.length<6||o.length>20?(N.password="密码长度6-20位",e=!1):/^[A-Za-z]/.test(o)||(N.password="密码必须字母开头",e=!1):(N.password="密码不能为空",e=!1),I.confirmPassword?I.confirmPassword!==o&&(N.confirmPassword="两次输入的密码不一致",e=!1):(N.confirmPassword="请再次输入密码",e=!1),e})()){U.value=!0;try{const e=await y({phone:I.phone,password:I.password,sms_code:I.code,confirm_password:I.confirmPassword});200===e.code?(g({title:"修改成功！",icon:"success"}),setTimeout((()=>{v()}),1500)):g({title:e.msg||"修改失败",icon:"none"})}catch(e){console.error("重置密码失败",e),g({title:e.msg||"请求异常",icon:"none"})}finally{U.value=!1}}},B=o(!1),Y=o(!1),Z=o(!1),D=o(60),E=async()=>{if(!Z.value)if(I.phone)if(/^1[3-9]\d{9}$/.test(I.phone))try{const e=await _({phone:I.phone,type:2});if(200===e.code){g({title:"验证码已发送",icon:"success"}),Z.value=!0;const e=setInterval((()=>{D.value--,D.value<=0&&(clearInterval(e),Z.value=!1,D.value=60)}),1e3)}else g({title:e.msg||"发送失败",icon:"none"})}catch(e){console.error("发送验证码失败",e),g({title:e.msg||"发送失败",icon:"none"})}else N.phone="请输入正确的手机号";else N.phone="请输入手机号"},J=()=>{B.value=!B.value},L=()=>{Y.value=!Y.value};return(e,o)=>{const s=a(t("LayoutNavigation"),V),y=z,g=a(t("u-input"),r),v=a(t("u-text"),c),_=d,Q=P,R=a(t("u-icon"),i),T=a(t("CxComfirmBtn"),k);return p(),l(_,{class:"page-wrap index"},{default:n((()=>[u(s,{title:m(F)},null,8,["title"]),u(_,{class:"page-content"},{default:n((()=>[u(_,{class:"container"},{default:n((()=>[u(_,{class:"input-item"},{default:n((()=>[u(y,{class:"input-icon",src:C,mode:"aspectFit"}),u(g,{modelValue:m(I).phone,"onUpdate:modelValue":[o[0]||(o[0]=e=>m(I).phone=e),o[1]||(o[1]=e=>$("phone"))],placeholder:"请输入您的手机号码",type:"number",border:"none",maxlength:"11","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),m(N).phone?(p(),l(v,{key:0,class:"error-text",text:m(N).phone,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):f("",!0)])),_:1}),u(_,{class:"input-item"},{default:n((()=>[u(y,{class:"input-icon",src:b,mode:"aspectFit"}),u(g,{modelValue:m(I).code,"onUpdate:modelValue":[o[2]||(o[2]=e=>m(I).code=e),o[3]||(o[3]=e=>$("code"))],placeholder:"请输入验证码",type:"text",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue"]),m(N).code?f("",!0):(p(),l(Q,{key:0,onClick:E,class:"verify-btn",style:h({color:m(Z)?"#ccc":"#ff4d4d",fontWeight:"normal"})},{default:n((()=>[x(w(m(Z)?`${m(D)}s后重试`:"获取验证码"),1)])),_:1},8,["style"])),m(N).code?(p(),l(v,{key:1,class:"error-text",text:m(N).code,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):f("",!0)])),_:1}),u(_,{class:"input-item"},{default:n((()=>[u(y,{class:"input-icon",src:j,mode:"aspectFit"}),u(g,{modelValue:m(I).password,"onUpdate:modelValue":[o[4]||(o[4]=e=>m(I).password=e),o[5]||(o[5]=e=>$("password"))],placeholder:"字母开头,必须包含特殊字符6-20位",type:m(B)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),u(R,{name:m(B)?"eye":"",size:"36",color:"#999",onClick:J},null,8,["name"]),m(N).password?(p(),l(v,{key:0,class:"error-text",text:m(N).password,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):f("",!0)])),_:1}),u(_,{class:"input-item"},{default:n((()=>[u(y,{class:"input-icon",src:j,mode:"aspectFit"}),u(g,{modelValue:m(I).confirmPassword,"onUpdate:modelValue":[o[6]||(o[6]=e=>m(I).confirmPassword=e),o[7]||(o[7]=e=>$("confirmPassword"))],placeholder:"请再次输入密码",type:m(Y)?"text":"password",border:"none","input-align":"left","placeholder-style":"color: #999; font-size: 24rpx;"},null,8,["modelValue","type"]),u(R,{name:m(Y)?"eye":"",size:"36",color:"#999",onClick:L},null,8,["name"]),m(N).confirmPassword?(p(),l(v,{key:0,class:"error-text",text:m(N).confirmPassword,color:"#ff4d4d",size:"20",margin:"0 0 0rpx 90rpx"},null,8,["text"])):f("",!0)])),_:1})])),_:1}),u(_,{class:"regist-btn-wrap"},{default:n((()=>[u(T,{text:"确认修改",loading:m(U),onClick:A},null,8,["loading"])])),_:1})])),_:1}),u(_)])),_:1})}}},[["__scopeId","data-v-2277518d"]]);export{F as default};
